<!doctype html>
<html lang="en" dir="ltr" class="plugin-moonwave plugin-id-moonwave" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Store | Lyra</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://paradoxum-games.github.io/lyra/api/Store"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Store | Lyra"><meta data-rh="true" name="description" content="Coordinates Sessions and provides a safe, high-level API for interacting with
persistent data stored in Roblox DataStores and MemoryStores.

**Core Responsibilities:**
- Manages the lifecycle of `Session` objects for individual data keys (e.g., player IDs).
- Provides methods for loading, reading (`get`), updating (`update`), and saving data.
- Implements atomic multi-key transactions (`tx`).
- Handles data validation, migrations, and optional legacy data import.
- Abstracts away underlying complexities like data sharding (`Files`), distributed
  locking (`Locks`), and transaction coordination (`Transactions`).
- Integrates with a configurable logging system (`Log`).

**Usage Example:**
```lua
local store = Store.createStore({
	name = &quot;PlayerData&quot;,
	template = {
		coins = 0,
		items = {},
	},
	schema = function(data)
		return typeof(data.coins) == &quot;number&quot; and typeof(data.items) == &quot;table&quot;,
		&quot;Invalid data format&quot;
	end,
	-- ... other config options
})

-- Load data for a player
store:load(&quot;player_1&quot;):andThen(function()
	-- Get current data
	return store:get(&quot;player_1&quot;)
end):andThen(function(data)
	print(data.coins) -- 0

	-- Update data
	return store:update(&quot;player_1&quot;, function(data)
		data.coins += 100
		return true -- Must return true to commit changes
	end)
end)
```"><meta data-rh="true" property="og:description" content="Coordinates Sessions and provides a safe, high-level API for interacting with
persistent data stored in Roblox DataStores and MemoryStores.

**Core Responsibilities:**
- Manages the lifecycle of `Session` objects for individual data keys (e.g., player IDs).
- Provides methods for loading, reading (`get`), updating (`update`), and saving data.
- Implements atomic multi-key transactions (`tx`).
- Handles data validation, migrations, and optional legacy data import.
- Abstracts away underlying complexities like data sharding (`Files`), distributed
  locking (`Locks`), and transaction coordination (`Transactions`).
- Integrates with a configurable logging system (`Log`).

**Usage Example:**
```lua
local store = Store.createStore({
	name = &quot;PlayerData&quot;,
	template = {
		coins = 0,
		items = {},
	},
	schema = function(data)
		return typeof(data.coins) == &quot;number&quot; and typeof(data.items) == &quot;table&quot;,
		&quot;Invalid data format&quot;
	end,
	-- ... other config options
})

-- Load data for a player
store:load(&quot;player_1&quot;):andThen(function()
	-- Get current data
	return store:get(&quot;player_1&quot;)
end):andThen(function(data)
	print(data.coins) -- 0

	-- Update data
	return store:update(&quot;player_1&quot;, function(data)
		data.coins += 100
		return true -- Must return true to commit changes
	end)
end)
```"><link data-rh="true" rel="canonical" href="https://paradoxum-games.github.io/lyra/api/Store"><link data-rh="true" rel="alternate" href="https://paradoxum-games.github.io/lyra/api/Store" hreflang="en"><link data-rh="true" rel="alternate" href="https://paradoxum-games.github.io/lyra/api/Store" hreflang="x-default"><link rel="stylesheet" href="/lyra/assets/css/styles.f56ecc6a.css">
<script src="/lyra/assets/js/runtime~main.83ac27a8.js" defer="defer"></script>
<script src="/lyra/assets/js/main.55b408dc.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/lyra/"><b class="navbar__title text--truncate">Lyra</b></a><a class="navbar__item navbar__link" href="/lyra/docs/intro">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/lyra/api/">API</a><a class="navbar__item navbar__link" href="/lyra/changelog">Changelog</a></div><div class="navbar__items navbar__items--right"><a href="https://wally.run/package/paradoxum-games/lyra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Wally<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/paradoxum-games/lyra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docPageContainer_wNNk"><div class="docPage_Dpn1"><div class="docSidebarContainer_o_re"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lyra/api/PlayerStore">​Player​Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lyra/api/Lyra">​Lyra</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/lyra/api/Store">Internal</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/lyra/api/Store">​Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Session">​Session</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Locks">​Locks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Constants">​Constants</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Files">​Files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Log">​Log</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/PromiseQueue">​Promise​Queue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Types">​Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Transactions">​Transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Migrations">​Migrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/hashMapRetry">hash​Map​Retry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/dataStoreRetry">data​Store​Retry</a></li></ul></li></ul></nav></div></div><main class="docMainContainer_HJE1"><div class="container padding-vert--lg"><div class="row"><div class="col docItemCol_MU3C"><div class="docItemContainer_Wv98"><article><div class="member_J0w1 markdown"><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_oUs_"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><header><h1 class="docTitle_mZRt" style="text-decoration:none"><span style="display:inline-block">Store</span></h1><div class="luaClassTags_EipM"><span class="badge_Ba2I" style="color:#9b59b6"><span class="badgeTooltip_cWXP">This item is only intended to be used by the module&#x27;s authors.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#9b59b6" role="img" aria-label="This item is only intended to be used by the module&#x27;s authors."><path d="m49.2 36 14.3 12.7.1-.7c0-6.7-6.1-12.1-13.6-12.1l-.8.1z"></path><path d="M50 27.8c12.5 0 22.7 9 22.7 20.1 0 2.6-.6 5-1.6 7.3L84.4 67c6.9-5 12.3-11.6 15.6-19.1-7.9-17.6-27.3-30.1-50-30.1-6.4 0-12.5 1-18.1 2.8l9.8 8.6c2.6-.8 5.4-1.4 8.3-1.4zM4.5 16.9l10.4 9.2 2.1 1.8C9.5 33.1 3.5 40 0 48c7.9 17.7 27.3 30.2 50 30.2 7 0 13.8-1.2 19.9-3.4l1.9 1.7 13.3 11.7 5.8-5.1-80.6-71.3-5.8 5.1zm25.2 22.2 7 6.2c-.2.8-.3 1.8-.3 2.6C36.4 54.6 42.5 60 50 60c1 0 2-.2 3-.3l7 6.2c-3 1.3-6.4 2.1-10 2.1-12.5 0-22.7-9-22.7-20.1 0-3.1.9-6.1 2.4-8.8z"></path></svg> <!-- -->Private</span></span></div><label class="privateToggle_lmfE"><span class="privateCheckboxContainer_psRa"><input class="privateCheckboxInternal_IKP2" type="checkbox" name="checkbox"><span class="privateCheckboxControl_Ov8U"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path fill="none" stroke="currentColor" stroke-width="3" d="M4 11.91l5.37 5.37L19.79 5.59"></path></svg></span></span><span class="privateCheckboxLabel_Vmvs">Show Private</span></label><div>
<p>
  Coordinates Sessions and provides a safe, high-level API for interacting with
  persistent data stored in Roblox DataStores and MemoryStores.
</p>
<p><strong>Core Responsibilities:</strong></p>
<ul>
  <li>Manages the lifecycle of <code>Session</code> objects for individual data keys (e.g., player IDs).</li>
  <li>Provides methods for loading, reading (<code>get</code>), updating (<code>update</code>), and saving data.</li>
  <li>Implements atomic multi-key transactions (<code>tx</code>).</li>
  <li>Handles data validation, migrations, and optional legacy data import.</li>
  <li>
    Abstracts away underlying complexities like data sharding (<code>Files</code>), distributed
    locking (<code>Locks</code>), and transaction coordination (<code>Transactions</code>).
  </li>
  <li>Integrates with a configurable logging system (<code>Log</code>).</li>
</ul>
<p><strong>Usage Example:</strong></p>
<pre class="language-lua"><code class="language-lua"><span class="token keyword">local</span> store <span class="token operator">=</span> Store<span class="token punctuation">.</span><span class="token function">createStore</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
	name <span class="token operator">=</span> <span class="token string">"PlayerData"</span><span class="token punctuation">,</span>
	template <span class="token operator">=</span> <span class="token punctuation">{</span>
		coins <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
		items <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
	<span class="token punctuation">}</span><span class="token punctuation">,</span>
	schema <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
		<span class="token keyword">return</span> <span class="token function">typeof</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>coins<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"number"</span> <span class="token keyword">and</span> <span class="token function">typeof</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>items<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token string">"table"</span><span class="token punctuation">,</span>
		<span class="token string">"Invalid data format"</span>
	<span class="token keyword">end</span><span class="token punctuation">,</span>
	<span class="token comment">-- ... other config options</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>

<span class="token comment">-- Load data for a player</span>
store<span class="token punctuation">:</span><span class="token function">load</span><span class="token punctuation">(</span><span class="token string">"player_1"</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">andThen</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
	<span class="token comment">-- Get current data</span>
	<span class="token keyword">return</span> store<span class="token punctuation">:</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">"player_1"</span><span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token function">andThen</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
	<span class="token function">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>coins<span class="token punctuation">)</span> <span class="token comment">-- 0</span>

	<span class="token comment">-- Update data</span>
	<span class="token keyword">return</span> store<span class="token punctuation">:</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token string">"player_1"</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
		data<span class="token punctuation">.</span>coins <span class="token operator">+</span><span class="token operator">=</span> <span class="token number">100</span>
		<span class="token keyword">return</span> <span class="token keyword">true</span> <span class="token comment">-- Must return true to commit changes</span>
	<span class="token keyword">end</span><span class="token punctuation">)</span>
<span class="token keyword">end</span><span class="token punctuation">)</span>
</code></pre>
</div></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="types">Types<a href="#types" class="hash-link" aria-label="Direct link to Types" title="Direct link to Types">​</a></h2><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="StoreConfig"><code style="text-decoration:none">StoreConfig</code><a href="#StoreConfig" class="hash-link" aria-label="Direct link to StoreConfig" title="Direct link to StoreConfig">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L97"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code class="purple_ieR2">interface</code> <code>StoreConfig<!-- --> <!-- -->{</code><div class="inset_uKQm"><div><code>name<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>A unique name for this store (e.g., "PlayerDataProd"). Used for logging and deriving DataStore/MemoryStore keys.</p>
</span></span></div><div><code>template<!-- -->: </code><code class="blue_P4bS">T</code><span class="inlineDescription_G7Er">-- <span>
<p>A deep copyable Luau table/value representing the default state for a new key.</p>
</span></span></div><div><code>schema<!-- -->: </code><code class="purple_ieR2">(</code><code>value<!-- -->: </code><code class="blue_P4bS">any</code><code class="purple_ieR2">)</code><code class="purple_ieR2"> → </code><code class="purple_ieR2">(</code><div class="inset_uKQm"><code class="blue_P4bS">boolean</code><code class="purple_ieR2">,</code></div><div class="inset_uKQm"><code class="blue_P4bS">string?</code></div><code class="purple_ieR2">)</code><span class="inlineDescription_G7Er">-- <span>
<p>A validation function (e.g., created with <code>t</code>) that checks if data conforms to the expected structure. Returns <code>true</code> if valid, or <code>false</code> and an error message if invalid.</p>
</span></span></div><div><code>migrationSteps<!-- -->: </code><code class="purple_ieR2">{</code><code class="blue_P4bS">Types.MigrationStep</code><code class="purple_ieR2">}</code><code class="blue_P4bS">?</code><span class="inlineDescription_G7Er">-- <span>
<p>An optional ordered list of migration steps to apply to data loaded from the DataStore if its schema is older than the current version. See <code>Migrations.luau</code>.</p>
</span></span></div><div><code>importLegacyData<!-- -->: </code><code class="purple_ieR2">(</code><code class="green_DgR4">(</code><code>key<!-- -->: </code><code class="blue_P4bS">string</code><code class="green_DgR4">)</code><code class="green_DgR4"> → </code><code class="blue_P4bS">any?</code><code class="purple_ieR2">)</code><code class="blue_P4bS">?</code><span class="inlineDescription_G7Er">-- <span>
<p>An optional function to load data from a different, legacy storage system when a key is accessed for the first time and doesn't exist in this store.</p>
</span></span></div><div><code>dataStoreService<!-- -->: </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="https://developer.roblox.com/en-us/api-reference/class/DataStoreService" target="_blank" rel="noopener noreferrer">DataStoreService?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" style="color:gray;vertical-align:middle;margin-left:2px"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></code><span class="inlineDescription_G7Er">-- <span>
<p>An optional override for the Roblox DataStoreService. Useful for testing or custom storage implementations. Defaults to <code>game:GetService("DataStoreService")</code>.</p>
</span></span></div><div><code>memoryStoreService<!-- -->: </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="https://developer.roblox.com/en-us/api-reference/class/MemoryStoreService" target="_blank" rel="noopener noreferrer">MemoryStoreService?<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" style="color:gray;vertical-align:middle;margin-left:2px"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></code><span class="inlineDescription_G7Er">-- <span>
<p>An optional override for the Roblox MemoryStoreService. Useful for testing. Defaults to <code>game:GetService("MemoryStoreService")</code>.</p>
</span></span></div><div><code>useMock<!-- -->: </code><code class="blue_P4bS">boolean?</code><span class="inlineDescription_G7Er">-- <span>
<p>If true (and running in Studio), uses mock in-memory implementations of DataStoreService and MemoryStoreService instead of the actual Roblox services. Useful for testing in a controlled environment. Defaults to <code>false</code>.</p>
</span></span></div><div><code>changedCallbacks<!-- -->: </code><code class="purple_ieR2">{</code><code class="green_DgR4">(</code><div class="inset_uKQm"><code>key<!-- -->: </code><code class="blue_P4bS">string</code><code class="green_DgR4">,</code></div><div class="inset_uKQm"><code>newData<!-- -->: </code><code class="blue_P4bS">T</code><code class="green_DgR4">,</code></div><div class="inset_uKQm"><code>oldData<!-- -->: </code><code class="blue_P4bS">T?</code></div><code class="green_DgR4">)</code><code class="green_DgR4"> → </code><code class="green_DgR4">(</code><code class="green_DgR4">)</code><code class="purple_ieR2">}</code><code class="blue_P4bS">?</code><span class="inlineDescription_G7Er">-- <span>
<p>An optional list of functions called <em>after</em> data for a key has been successfully updated. Provides the key, the new data state, and the previous data state (if available).</p>
</span></span></div><div><code>logCallback<!-- -->: </code><code class="purple_ieR2">(</code><code class="green_DgR4">(</code><code>logMessage<!-- -->: </code><code class="blue_P4bS">Log.LogMessage</code><code class="green_DgR4">)</code><code class="green_DgR4"> → </code><code class="green_DgR4">(</code><code class="green_DgR4">)</code><code class="purple_ieR2">)</code><code class="blue_P4bS">?</code><span class="inlineDescription_G7Er">-- <span>
<p>A function to receive log messages generated by this Store instance and its components. If omitted, logs are discarded. See <a href="/lyra/api/Log">Log</a>.</p>
</span></span></div><div><code>onLockLost<!-- -->: </code><code class="purple_ieR2">(</code><code class="green_DgR4">(</code><code>key<!-- -->: </code><code class="blue_P4bS">string</code><code class="green_DgR4">)</code><code class="green_DgR4"> → </code><code class="green_DgR4">(</code><code class="green_DgR4">)</code><code class="purple_ieR2">)</code><code class="blue_P4bS">?</code><span class="inlineDescription_G7Er">-- <span>
<p>An optional callback function triggered if the distributed lock for a key's session is lost unexpectedly (e.g., due to expiration or external interference). This usually indicates the session is no longer safe to use.</p>
</span></span></div></div><code>}</code></div><div>
<p>Configuration options for creating a new Store instance using <code>createStore</code>.</p>
</div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="functions">Functions<a href="#functions" class="hash-link" aria-label="Direct link to Functions" title="Direct link to Functions">​</a></h2><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="createStore"><code style="text-decoration:none">createStore</code><a href="#createStore" class="hash-link" aria-label="Direct link to createStore" title="Direct link to createStore">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L217"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->.</code><code class="green_DgR4">createStore</code><code>(</code><div class="inset_uKQm"><div><code>config<!-- -->: </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="/lyra/api/Store#StoreConfig">StoreConfig</a></code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">T</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Configuration options for the store.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="/lyra/api/Store">Store</a></code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">T</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>A new, initialized Store instance.</p>
</span></span></div><div>
<p>Factory function to create a new Store instance.</p>
<p>
  Initializes the store context, sets up DataStore and MemoryStore connections
  (real or mock), validates the template schema, and returns the configured Store object.
</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="txInternal"><code style="text-decoration:none">txInternal</code><a href="#txInternal" class="hash-link" aria-label="Direct link to txInternal" title="Direct link to txInternal">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L764"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->.</code><code class="green_DgR4">txInternal</code><code>(</code><div class="inset_uKQm"><div><code>self<!-- -->: </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="/lyra/api/Store">Store</a></code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">T</code><code class="op_lSLc">&gt;</code><code>,</code></div><div><code>keys<!-- -->: </code><code class="purple_ieR2">{</code><code class="blue_P4bS">string</code><code class="purple_ieR2">}</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>An array of keys involved in the transaction.</p>
</span></span></div><div><code>transformFunction<!-- -->: </code><code class="purple_ieR2">(</code><code class="green_DgR4">(</code><code>state<!-- -->: </code><code class="yellow_QJap">{</code><span><code>[</code><code class="blue_P4bS">string</code><code>]</code></span><code>: </code><code class="blue_P4bS">any</code><code class="yellow_QJap">}</code><code class="green_DgR4">)</code><code class="green_DgR4"> → </code><code class="blue_P4bS">boolean</code><code class="purple_ieR2">)</code><code class="op_lSLc"> | </code><code class="purple_ieR2">(</code><code class="green_DgR4">(</code><code>state<!-- -->: </code><code class="yellow_QJap">{</code><span><code>[</code><code class="blue_P4bS">string</code><code>]</code></span><code>: </code><code class="blue_P4bS">any</code><code class="yellow_QJap">}</code><code class="green_DgR4">)</code><code class="green_DgR4"> → </code><code class="green_DgR4">{</code><span><code>[</code><code class="blue_P4bS">string</code><code>]</code></span><code>: </code><code class="blue_P4bS">any</code><code class="green_DgR4">}</code><code class="op_lSLc"> | </code><code class="blue_P4bS">false</code><code class="purple_ieR2">)</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>A function that receives the current state of all keys and, depending on <code>immutable</code>, either modifies it directly (mutable) and returns <code>true</code> to commit, or returns a new state (immutable) to commit. Must return <code>false</code> to abort the transaction.</p>
</span></span></div><div><code>immutable<!-- -->: </code><code class="blue_P4bS">boolean</code></div></div><code>) → </code><code class="blue_P4bS">Promise</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves with <code>true</code> if the transaction was successful, or <code>false</code> if it was aborted. Rejects on error.</p>
</span></span></div><div>
<p>
  Internal helper to perform transaction logic on multiple keys.
  Handles acquiring locks, validating state, and committing changes atomically
  via a two-phase commit process.
</p>
<p>
  Supports both immutable and mutable transactions, where <code>immutable</code> controls
  whether the data passed to the <code>transformFunction</code> is a deep copy (mutable)
  or a reference to the canonical, frozen data (immutable).
</p>
<p><strong>Implementation Details:</strong></p>
<ul>
  <li>
    Uses <code>PromiseQueue.multiQueueAdd</code> to ensure the transform function only runs
    when all involved session queues are ready.
  </li>
  <li>
    Uses a temporary <code>txLockPromise</code> on sessions to block concurrent <code>update</code> calls
    while the transaction logic is executing.
  </li>
  <li>Performs a two-phase commit using a transaction marker in the <code>txStore</code>:
    <ol>
      <li>Write <code>false</code> to <code>txStore</code> under a unique <code>txId</code>.</li>
      <li>Update all primary <code>recordStore</code> entries with the new data and <code>txId</code>.</li>
      <li>If successful, remove the <code>txId</code> entry from <code>txStore</code>.</li>
    </ol>
  </li>
  <li>
    If any step fails, attempts to revert changes by rewriting records without the <code>txId</code>
    and removing the <code>txId</code> marker.
  </li>
  <li>Uses <code>JsonPatch</code> to calculate differences for efficient storage in <code>TxInfo</code>.</li>
</ul>
<p>Propagates DataStore errors encountered during the commit or revert phases.</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Key not loaded&quot;</td><td>If any key in the `keys` array has not been loaded.</td></tr><tr><td>&quot;Key is already locked by another transaction&quot;</td><td>If any key is already involved in an ongoing `tx`.</td></tr><tr><td>&quot;Key is closed&quot;</td><td>If any involved session has been closed (e.g., due to lock loss).</td></tr><tr><td>&quot;Store is closed&quot;</td><td>If the store instance has been closed.</td></tr><tr><td>&quot;Schema validation failed&quot;</td><td>If the data for any key after transformation fails the schema check.</td></tr><tr><td>&quot;Keys changed in transaction&quot;</td><td>If the `transformFunction` attempts to add or remove keys from the state table it receives.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="load"><code style="text-decoration:none">load</code><a href="#load" class="hash-link" aria-label="Direct link to load" title="Direct link to load">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L351"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">load</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>The unique identifier for the data to load (e.g., "player_123").</p>
</span></span></div><div><code>userIds<!-- -->: </code><code class="purple_ieR2">{</code><code class="blue_P4bS">number</code><code class="purple_ieR2">}</code><code class="blue_P4bS">?</code><span class="inlineDescription_G7Er">-- <span>
<p>Optional list of UserIDs for DataStore key tagging.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves when the data is successfully loaded and the session is ready, or rejects on error.</p>
</span></span></div><div>
<p>
  Acquires a distributed lock, loads data for the given key into memory,
  and establishes a <code>Session</code> object to manage the key's state.
</p>
<p>
  This must be called before performing operations like <code>get</code>, <code>update</code>, or <code>save</code>
  on the key. It handles concurrent load attempts and waits for any ongoing unload
  operations to complete first.
</p>
<p>Propagates errors from <code>Session.load</code> (e.g., lock acquisition failure, DataStore errors).</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Load already in progress&quot;</td><td>If `load` is called again for the same key while a previous load is still running.</td></tr><tr><td>&quot;Store is closed&quot;</td><td>If the store instance has been closed via `close()`.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="loadAsync"><code style="text-decoration:none">loadAsync</code><a href="#loadAsync" class="hash-link" aria-label="Direct link to loadAsync" title="Direct link to loadAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L460"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">loadAsync</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>The unique identifier for the data to load.</p>
</span></span></div><div><code>userIds<!-- -->: </code><code class="purple_ieR2">{</code><code class="blue_P4bS">number</code><code class="purple_ieR2">}</code><code class="blue_P4bS">?</code><span class="inlineDescription_G7Er">-- <span>
<p>Optional list of UserIDs for DataStore key tagging.</p>
</span></span></div></div><code>) → </code><code>(</code><code>)</code></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#load">Store:load</a>. Waits for the Promise to settle.
  Throws an error if the load fails or is cancelled.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>any</td><td>Throws any error encountered during the load process.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="unload"><code style="text-decoration:none">unload</code><a href="#unload" class="hash-link" aria-label="Direct link to unload" title="Direct link to unload">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L475"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">unload</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The unique identifier for the data to unload.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves when the data is successfully unloaded, or rejects on error.</p>
</span></span></div><div>
<p>
  Unloads data for the given key from memory, saves any pending changes,
  releases the distributed lock, and ends the session.
</p>
<p>Propagates errors from <code>Session:unload</code> (e.g., save failures).</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Store is closed&quot;</td><td>If the store instance has been closed.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="unloadAsync"><code style="text-decoration:none">unloadAsync</code><a href="#unloadAsync" class="hash-link" aria-label="Direct link to unloadAsync" title="Direct link to unloadAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L529"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">unloadAsync</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The unique identifier for the data to unload.</p>
</span></span></div></div><code>) → </code><code>(</code><code>)</code></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#unload">Store:unload</a>. Waits for the Promise to settle.
  Throws an error if the unload fails.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>any</td><td>Throws any error encountered during the unload process.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="get"><code style="text-decoration:none">get</code><a href="#get" class="hash-link" aria-label="Direct link to get" title="Direct link to get">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L614"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">get</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The key whose data to retrieve.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">T</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves with the current data object (potentially a deep copy).</p>
</span></span></div><div>
<p>
  Gets the current, in-memory data state for the given key.
  Requires the key to be loaded first via <code>load()</code>.
  If the key is still loading, this will wait for it to finish.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Key not loaded&quot;</td><td>If `load()` has not been successfully called for this key.</td></tr><tr><td>&quot;Store is closed&quot;</td><td>If the store has been closed.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="getAsync"><code style="text-decoration:none">getAsync</code><a href="#getAsync" class="hash-link" aria-label="Direct link to getAsync" title="Direct link to getAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L633"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">getAsync</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The key whose data to retrieve.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">T</code><span class="inlineDescription_G7Er">-- <span>
<p>The current data object.</p>
</span></span></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#get">Store:get</a>. Waits for the Promise to settle.
  Throws an error if getting the data fails.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Key not loaded&quot;</td><td>If `load()` has not been successfully called for this key.</td></tr><tr><td>&quot;Store is closed&quot;</td><td>If the store has been closed.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="update"><code style="text-decoration:none">update</code><a href="#update" class="hash-link" aria-label="Direct link to update" title="Direct link to update">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L655"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">update</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>The key whose data to update.</p>
</span></span></div><div><code>transformFunction<!-- -->: </code><code class="purple_ieR2">(</code><code>data<!-- -->: </code><code class="blue_P4bS">T</code><code class="purple_ieR2">)</code><code class="purple_ieR2"> → </code><code class="blue_P4bS">boolean</code><span class="inlineDescription_G7Er">-- <span>
<p>A function that receives the current data and returns <code>true</code> to commit changes or <code>false</code> to abort.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">boolean</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves with <code>true</code> if the transform function returned <code>true</code> and the update was successfully queued, or <code>false</code> if the transform function returned <code>false</code>. Rejects on errors like key not loaded, store closed, or schema validation failure after transformation.</p>
</span></span></div><div>
<p>Applies changes to the data for a given key using a transform function.</p>
<p>
  The <code>transformFunction</code> receives the current data and can modify it directly.
  It <strong>must</strong> return <code>true</code> to indicate that changes were made and should be
  saved, or <code>false</code> to abort the update without saving.
</p>
<p>
  Changes are applied optimistically to the in-memory state first and then queued
  for saving to the DataStore.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Key not loaded&quot;</td><td>If `load()` has not been successfully called for this key.</td></tr><tr><td>&quot;Store is closed&quot;</td><td>If the store instance has been closed.</td></tr><tr><td>&quot;Schema validation failed&quot;</td><td>If the data returned by `transformFunction` does not pass the store&#x27;s schema check.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="updateAsync"><code style="text-decoration:none">updateAsync</code><a href="#updateAsync" class="hash-link" aria-label="Direct link to updateAsync" title="Direct link to updateAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L678"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">updateAsync</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>The key whose data to update.</p>
</span></span></div><div><code>transformFunction<!-- -->: </code><code class="purple_ieR2">(</code><code>data<!-- -->: </code><code class="blue_P4bS">T</code><code class="purple_ieR2">)</code><code class="purple_ieR2"> → </code><code class="blue_P4bS">boolean</code><span class="inlineDescription_G7Er">-- <span>
<p>The transformation function.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">boolean</code><span class="inlineDescription_G7Er">-- <span>
<p>Returns the boolean value returned by the <code>transformFunction</code>.</p>
</span></span></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#update">Store:update</a>. Waits for the Promise to settle.
  Throws an error if the update fails.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Key not loaded&quot;</td><td>If `load()` has not been successfully called for this key.</td></tr><tr><td>&quot;Store is closed&quot;</td><td>If the store instance has been closed.</td></tr><tr><td>&quot;Schema validation failed&quot;</td><td>If the data returned by `transformFunction` does not pass the store&#x27;s schema check.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="updateImmutable"><code style="text-decoration:none">updateImmutable</code><a href="#updateImmutable" class="hash-link" aria-label="Direct link to updateImmutable" title="Direct link to updateImmutable">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L702"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">updateImmutable</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>The key whose data to update.</p>
</span></span></div><div><code>transformFunction<!-- -->: </code><code class="purple_ieR2">(</code><code>data<!-- -->: </code><code class="blue_P4bS">T</code><code class="purple_ieR2">)</code><code class="purple_ieR2"> → </code><code class="blue_P4bS">T</code><code class="op_lSLc"> | </code><code class="blue_P4bS">false</code><span class="inlineDescription_G7Er">-- <span>
<p>A function that receives the current data and returns a new copy of the data with changes to commit changes, or <code>false</code> to abort.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">boolean</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves with <code>true</code> if the transform function committed and the update was successfully queued, or <code>false</code> if the transform function returned <code>false</code>. Rejects on errors like key not loaded, store closed, or schema validation failure after transformation.</p>
</span></span></div><div>
<p>
  Applies changes to the data for a given key using a transform function,
  with immutable copy-on-write semantics.
</p>
<p>
  The <code>transformFunction</code> receives the current data but frozen (immutable),
  and cannot modify it directly. Instead, it should return new data that
  reflects the desired changes. Otherwise it should return <code>false</code> to abort
  the update without saving.
</p>
<p>
  Changes are applied optimistically to the in-memory state first and then queued
  for saving to the DataStore.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Key not loaded&quot;</td><td>If `load()` has not been successfully called for this key.</td></tr><tr><td>&quot;Store is closed&quot;</td><td>If the store instance has been closed.</td></tr><tr><td>&quot;Schema validation failed&quot;</td><td>If the data returned by `transformFunction` does not pass the store&#x27;s schema check.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="updateImmutableAsync"><code style="text-decoration:none">updateImmutableAsync</code><a href="#updateImmutableAsync" class="hash-link" aria-label="Direct link to updateImmutableAsync" title="Direct link to updateImmutableAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L725"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">updateImmutableAsync</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>The key whose data to update.</p>
</span></span></div><div><code>transformFunction<!-- -->: </code><code class="purple_ieR2">(</code><code>data<!-- -->: </code><code class="blue_P4bS">T</code><code class="purple_ieR2">)</code><code class="purple_ieR2"> → </code><code class="blue_P4bS">T</code><code class="op_lSLc"> | </code><code class="blue_P4bS">false</code><span class="inlineDescription_G7Er">-- <span>
<p>The transformation function.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">boolean</code><span class="inlineDescription_G7Er">-- <span>
<p>Returns <code>true</code> if the update was successful, or <code>false</code> if the transform function returned <code>false</code>.</p>
</span></span></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#updateImmutable">Store:updateImmutable</a>. Waits for the Promise to settle.
  Throws an error if the update fails.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Key not loaded&quot;</td><td>If `load()` has not been successfully called for this key.</td></tr><tr><td>&quot;Store is closed&quot;</td><td>If the store instance has been closed.</td></tr><tr><td>&quot;Schema validation failed&quot;</td><td>If the data returned by `transformFunction` does not pass the store&#x27;s schema check.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="tx"><code style="text-decoration:none">tx</code><a href="#tx" class="hash-link" aria-label="Direct link to tx" title="Direct link to tx">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1087"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">tx</code><code>(</code><div class="inset_uKQm"><div><code>keys<!-- -->: </code><code class="purple_ieR2">{</code><code class="blue_P4bS">string</code><code class="purple_ieR2">}</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>An array of keys involved in the transaction.</p>
</span></span></div><div><code>transformFunction<!-- -->: </code><code class="purple_ieR2">(</code><code>state<!-- -->: </code><code class="green_DgR4">{</code><span><code>[</code><code class="blue_P4bS">string</code><code>]</code></span><code>: </code><code class="blue_P4bS">T</code><code class="green_DgR4">}</code><code class="purple_ieR2">)</code><code class="purple_ieR2"> → </code><code class="blue_P4bS">boolean</code><span class="inlineDescription_G7Er">-- <span>
<p>The transformation function.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">boolean</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves with <code>true</code> if the transaction was successful, or <code>false</code> if it was aborted. Rejects on error.</p>
</span></span></div><div>
<p>Performs an atomic transaction across multiple keys.</p>
<p>
  Requires the keys to be loaded first via <code>load()</code>. The <code>transformFunction</code>
  is called with the current state of all involved keys and must return <code>true</code>
  to commit changes or <code>false</code> to abort.
</p>
<p>
  Propagates errors from the transaction process, including DataStore errors,
  schema validation failures, and key loading issues.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Key not loaded&quot;</td><td>If any key in the `keys` array has not been loaded.</td></tr><tr><td>&quot;Key is already locked by another transaction&quot;</td><td>If any key is already involved in an ongoing `tx`.</td></tr><tr><td>&quot;Key is closed&quot;</td><td>If any involved session has been closed (e.g., due to lock loss).</td></tr><tr><td>&quot;Store is closed&quot;</td><td>If the store instance has been closed.</td></tr><tr><td>&quot;Schema validation failed&quot;</td><td>If the data for any key after transformation fails the schema check.</td></tr><tr><td>&quot;Keys changed in transaction&quot;</td><td>If the `transformFunction` attempts to add or remove keys from the state table it receives.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="txAsync"><code style="text-decoration:none">txAsync</code><a href="#txAsync" class="hash-link" aria-label="Direct link to txAsync" title="Direct link to txAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1104"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">txAsync</code><code>(</code><div class="inset_uKQm"><div><code>keys<!-- -->: </code><code class="purple_ieR2">{</code><code class="blue_P4bS">string</code><code class="purple_ieR2">}</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>An array of keys involved in the transaction.</p>
</span></span></div><div><code>transformFunction<!-- -->: </code><code class="purple_ieR2">(</code><code>state<!-- -->: </code><code class="green_DgR4">{</code><span><code>[</code><code class="blue_P4bS">string</code><code>]</code></span><code>: </code><code class="blue_P4bS">T</code><code class="green_DgR4">}</code><code class="purple_ieR2">)</code><code class="purple_ieR2"> → </code><code class="blue_P4bS">boolean</code><span class="inlineDescription_G7Er">-- <span>
<p>The transformation function.</p>
</span></span></div></div><code>) → </code><code>(</code><code>)</code></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#tx">Store:tx</a>. Waits for the Promise to settle.
  Throws an error if the transaction fails or is aborted.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>any</td><td>Throws any error encountered during the transaction.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="txImmutable"><code style="text-decoration:none">txImmutable</code><a href="#txImmutable" class="hash-link" aria-label="Direct link to txImmutable" title="Direct link to txImmutable">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1132"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">txImmutable</code><code>(</code><div class="inset_uKQm"><div><code>keys<!-- -->: </code><code class="purple_ieR2">{</code><code class="blue_P4bS">string</code><code class="purple_ieR2">}</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>An array of keys involved in the transaction.</p>
</span></span></div><div><code>transformFunction<!-- -->: </code><code class="purple_ieR2">(</code><code>state<!-- -->: </code><code class="green_DgR4">{</code><span><code>[</code><code class="blue_P4bS">string</code><code>]</code></span><code>: </code><code class="blue_P4bS">T</code><code class="green_DgR4">}</code><code class="purple_ieR2">)</code><code class="purple_ieR2"> → </code><code class="purple_ieR2">{</code><span><code>[</code><code class="blue_P4bS">string</code><code>]</code></span><code>: </code><code class="blue_P4bS">T</code><code class="purple_ieR2">}</code><code class="op_lSLc"> | </code><code class="blue_P4bS">false</code><span class="inlineDescription_G7Er">-- <span>
<p>The transformation function.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">boolean</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves with <code>true</code> if the transaction was successful, or <code>false</code> if it was aborted. Rejects on error.</p>
</span></span></div><div>
<p>Performs an atomic transaction across multiple keys with immutable, copy-on-write semantics.</p>
<p>
  The data passed to the function is frozen and cannot be modified directly.
  Instead, the function should return a new table with the desired changes.
</p>
<p>
  Requires the keys to be loaded first via <code>load()</code>. The <code>transformFunction</code>
  is called with the current state of all involved keys and must return the
  new state to commit or <code>false</code> to abort.
</p>
<p>
  Propagates errors from the transaction process, including DataStore errors,
  schema validation failures, and key loading issues.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Key not loaded&quot;</td><td>If any key in the `keys` array has not been loaded.</td></tr><tr><td>&quot;Key is already locked by another transaction&quot;</td><td>If any key is already involved in an ongoing `tx`.</td></tr><tr><td>&quot;Key is closed&quot;</td><td>If any involved session has been closed (e.g., due to lock loss).</td></tr><tr><td>&quot;Store is closed&quot;</td><td>If the store instance has been closed.</td></tr><tr><td>&quot;Schema validation failed&quot;</td><td>If the data for any key after transformation fails the schema check.</td></tr><tr><td>&quot;Keys changed in transaction&quot;</td><td>If the `transformFunction` attempts to add or remove keys from the state table it receives.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="txImmutableAsync"><code style="text-decoration:none">txImmutableAsync</code><a href="#txImmutableAsync" class="hash-link" aria-label="Direct link to txImmutableAsync" title="Direct link to txImmutableAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1152"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">txImmutableAsync</code><code>(</code><div class="inset_uKQm"><div><code>keys<!-- -->: </code><code class="purple_ieR2">{</code><code class="blue_P4bS">string</code><code class="purple_ieR2">}</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>An array of keys involved in the transaction.</p>
</span></span></div><div><code>transformFunction<!-- -->: </code><code class="purple_ieR2">(</code><code>state<!-- -->: </code><code class="green_DgR4">{</code><span><code>[</code><code class="blue_P4bS">string</code><code>]</code></span><code>: </code><code class="blue_P4bS">T</code><code class="green_DgR4">}</code><code class="purple_ieR2">)</code><code class="purple_ieR2"> → </code><code class="purple_ieR2">{</code><span><code>[</code><code class="blue_P4bS">string</code><code>]</code></span><code>: </code><code class="blue_P4bS">T</code><code class="purple_ieR2">}</code><code class="op_lSLc"> | </code><code class="blue_P4bS">false</code><span class="inlineDescription_G7Er">-- <span>
<p>The transformation function.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">boolean</code></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#txImmutable">Store:txImmutable</a>. Waits for the Promise to settle.
  Throws an error if the transaction fails or is aborted.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>any</td><td>Throws any error encountered during the transaction.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="save"><code style="text-decoration:none">save</code><a href="#save" class="hash-link" aria-label="Direct link to save" title="Direct link to save">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1178"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">save</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The key whose data to save.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves when the save operation completes successfully, rejects on error.</p>
</span></span></div><div>
<p>
  Forces an immediate save of the given key's current in-memory data state
  to the DataStore.
</p>

  
    
    
      <div class="admonition admonition-note alert alert--secondary">
        <div class="admonition-heading">
          <h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16">
                <path d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path>
              </svg></span><span class="admonition-title">NOTE</span></h5>
        </div>
        <div class="admonition-content">
          <p>
            Data is automatically saved periodically by the Session's autosave mechanism.
            Manual saves are typically only needed in specific scenarios like processing
            developer product purchases (<code>MarketplaceService.ProcessReceipt</code>) where immediate
            persistence is crucial before granting benefits.
          </p>
        </div>
      </div>
    
  

<p>Propagates errors from <code>Session:save</code> (e.g., DataStore write errors).</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Key not loaded&quot;</td><td>If `load()` has not been successfully called for this key.</td></tr><tr><td>&quot;Store is closed&quot;</td><td>If the store instance has been closed.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="saveAsync"><code style="text-decoration:none">saveAsync</code><a href="#saveAsync" class="hash-link" aria-label="Direct link to saveAsync" title="Direct link to saveAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1195"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">saveAsync</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The key whose data to save.</p>
</span></span></div></div><code>) → </code><code>(</code><code>)</code></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#save">Store:save</a>. Waits for the Promise to settle.
  Throws an error if the save fails.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>any</td><td>Throws any error encountered during the save operation.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="close"><code style="text-decoration:none">close</code><a href="#close" class="hash-link" aria-label="Direct link to close" title="Direct link to close">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1208"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">close</code><code>(</code><code>) → </code><code class="blue_P4bS">Promise</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves when all sessions have attempted to unload, or rejects if any session encountered an error during its unload process (errors are aggregated).</p>
</span></span></div><div>
<p>Closes the store, gracefully unloading all active sessions.</p>
<p>
  Attempts to save any pending changes for all loaded keys before releasing locks
  and removing sessions from memory. The store instance becomes unusable as soon as this is called.
</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="closeAsync"><code style="text-decoration:none">closeAsync</code><a href="#closeAsync" class="hash-link" aria-label="Direct link to closeAsync" title="Direct link to closeAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1261"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">closeAsync</code><code>(</code><code>) → </code><code>(</code><code>)</code></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#close">Store:close</a>. Waits for the Promise to settle.
  Throws an error if closing fails (i.e., if any session failed to unload).
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>any</td><td>Throws an error (potentially a table of errors) if closing fails.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="peek"><code style="text-decoration:none">peek</code><a href="#peek" class="hash-link" aria-label="Direct link to peek" title="Direct link to peek">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1279"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">peek</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The key whose data to peek at.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">T?</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves with the data object, or <code>nil</code> if the key doesn't exist. Rejects on DataStore errors.</p>
</span></span></div><div>
<p>
  Reads the current data for the given key directly from the DataStore,
  bypassing the session cache and locking mechanism.
</p>
<p>
  This provides a snapshot of the last saved state but does not load the key
  into an active session. Useful for inspecting data without acquiring a lock.
  Handles potential sharding and transaction status automatically.
</p>
<p>Propagates DataStore errors from underlying reads.</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="peekAsync"><code style="text-decoration:none">peekAsync</code><a href="#peekAsync" class="hash-link" aria-label="Direct link to peekAsync" title="Direct link to peekAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1327"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">peekAsync</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The key whose data to peek at.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">T?</code><span class="inlineDescription_G7Er">-- <span>
<p>The data object, or <code>nil</code> if the key doesn't exist.</p>
</span></span></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#peek">Store:peek</a>. Waits for the Promise to settle.
  Returns the data for the key if it exists. Throws on any errors from underlying DataStore operations.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>any</td><td>May throw errors from underlying DataStore operations.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="probeLockActive"><code style="text-decoration:none">probeLockActive</code><a href="#probeLockActive" class="hash-link" aria-label="Direct link to probeLockActive" title="Direct link to probeLockActive">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1340"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">probeLockActive</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The key to check the lock status for.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">boolean</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves with <code>true</code> if a lock is active, <code>false</code> otherwise. Rejects on MemoryStore errors.</p>
</span></span></div><div>
<p>Checks if a distributed lock is currently active for the given key in MemoryStore.</p>
<p>Propagates errors from <code>Locks.probeLockActive</code>.</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="probeLockActiveAsync"><code style="text-decoration:none">probeLockActiveAsync</code><a href="#probeLockActiveAsync" class="hash-link" aria-label="Direct link to probeLockActiveAsync" title="Direct link to probeLockActiveAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1358"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">probeLockActiveAsync</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The key to check the lock status for.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">boolean</code><span class="inlineDescription_G7Er">-- <span>
<p><code>true</code> if a lock is active, <code>false</code> otherwise.</p>
</span></span></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#probeLockActive">Store:probeLockActive</a>. Waits for the Promise to settle.
  Throws an error if the check fails.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>any</td><td>Throws any error encountered during the probe operation.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="listVersions"><code style="text-decoration:none">listVersions</code><a href="#listVersions" class="hash-link" aria-label="Direct link to listVersions" title="Direct link to listVersions">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1371"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">listVersions</code><code>(</code><div class="inset_uKQm"><div><code>params<!-- -->: </code><code class="blue_P4bS">ListVersionParams</code><span class="inlineDescription_G7Er">-- <span>
<p>Parameters specifying the key, sorting, date range, and page size.</p>
</span></span></div></div><code>) →  </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="https://developer.roblox.com/en-us/api-reference/class/DataStoreVersionPages" target="_blank" rel="noopener noreferrer">DataStoreVersionPages<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" style="color:gray;vertical-align:middle;margin-left:2px"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves with an iterator object (<code>DataStoreVersionPages</code>) that can be used to fetch pages of version history. Rejects on DataStore errors.</p>
</span></span></div><div>
<p>Lists historical versions of the data for a given key using DataStore versioning.</p>
<p>Propagates errors from <code>DataStore:ListVersionsAsync</code>.</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="listVersionsAsync"><code style="text-decoration:none">listVersionsAsync</code><a href="#listVersionsAsync" class="hash-link" aria-label="Direct link to listVersionsAsync" title="Direct link to listVersionsAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1394"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">listVersionsAsync</code><code>(</code><div class="inset_uKQm"><div><code>params<!-- -->: </code><code class="blue_P4bS">ListVersionParams</code><span class="inlineDescription_G7Er">-- <span>
<p>Parameters for listing versions.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="https://developer.roblox.com/en-us/api-reference/class/DataStoreVersionPages" target="_blank" rel="noopener noreferrer">DataStoreVersionPages<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" style="color:gray;vertical-align:middle;margin-left:2px"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></code><span class="inlineDescription_G7Er">-- <span>
<p>An iterator for version history.</p>
</span></span></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#listVersions">Store:listVersions</a>. Waits for the Promise to settle.
  Throws an error if listing versions fails.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>any</td><td>Throws any error encountered during the list operation.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="readVersion"><code style="text-decoration:none">readVersion</code><a href="#readVersion" class="hash-link" aria-label="Direct link to readVersion" title="Direct link to readVersion">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1409"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">readVersion</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>The key whose version to read.</p>
</span></span></div><div><code>version<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The specific version ID (obtained from <code>listVersions</code>).</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="purple_ieR2">(</code><div class="inset_uKQm"><code class="blue_P4bS">T</code><code class="purple_ieR2">,</code></div><div class="inset_uKQm"><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="https://developer.roblox.com/en-us/api-reference/class/DataStoreKeyInfo" target="_blank" rel="noopener noreferrer">DataStoreKeyInfo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" style="color:gray;vertical-align:middle;margin-left:2px"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></code></div><code class="purple_ieR2">)</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves with the data object (<code>T</code>) and the <code>DataStoreKeyInfo</code> for that version. Rejects if the version doesn't exist or on DataStore/read errors.</p>
</span></span></div><div>
<p>Reads the data content of a specific historical version for a given key.</p>
<p>Propagates DataStore errors from underlying reads.</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Record not found&quot;</td><td>If the specified version doesn&#x27;t exist.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="readVersionAsync"><code style="text-decoration:none">readVersionAsync</code><a href="#readVersionAsync" class="hash-link" aria-label="Direct link to readVersionAsync" title="Direct link to readVersionAsync">​</a></h3><span class="badge_Ba2I" style="color:#f1c40f"><span class="badgeTooltip_cWXP">This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#f1c40f" role="img" aria-label="This is a yielding function. When called, it will pause the Lua thread that called the function until a result is ready to be returned, without interrupting other scripts."><path d="M96.4 11.9c-1.4-2.5-4-4-6.9-4H10.8c-2.9 0-5.4 1.5-6.9 4-1.4 2.5-1.4 5.5 0 7.9L43.3 88c1.4 2.5 4 4 6.9 4 2.9 0 5.4-1.5 6.9-4l39.3-68.2c1.4-2.4 1.4-5.4 0-7.9zM46.3 54.5c1.1-1.1 2.3-1.6 3.8-1.6s2.8.5 3.8 1.6c1.1 1.1 1.6 2.3 1.6 3.8s-.5 2.8-1.6 3.8c-1.1 1.1-2.3 1.6-3.8 1.6s-2.8-.5-3.8-1.6c-1.1-1.1-1.6-2.3-1.6-3.8.1-1.5.6-2.8 1.6-3.8zm-.5-4.9V21.8h8.8v27.8h-8.8z"></path></svg> <!-- -->Yields</span></span><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Store.luau#L1453"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Store<!-- -->:</code><code class="green_DgR4">readVersionAsync</code><code>(</code><div class="inset_uKQm"><div><code>key<!-- -->: </code><code class="blue_P4bS">string</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>The key whose version to read.</p>
</span></span></div><div><code>version<!-- -->: </code><code class="blue_P4bS">string</code><span class="inlineDescription_G7Er">-- <span>
<p>The specific version ID.</p>
</span></span></div></div><code>) → </code><code>(</code><div class="inset_uKQm"><div><code class="blue_P4bS">T</code><code>,</code><span class="inlineDescription_G7Er">-- <span>
<p>The data object for the specified version.</p>
</span></span></div><div><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="https://developer.roblox.com/en-us/api-reference/class/DataStoreKeyInfo" target="_blank" rel="noopener noreferrer">DataStoreKeyInfo<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound" style="color:gray;vertical-align:middle;margin-left:2px"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></code><span class="inlineDescription_G7Er">-- <span>
<p>The key info for the specified version.</p>
</span></span></div></div><code>)</code></div><div>
<p>
  Synchronous wrapper for <a href="/lyra/api/Store#readVersion">Store:readVersion</a>. Waits for the Promise to settle.
  Throws an error if reading the version fails.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>any</td><td>Throws any error encountered during the read operation.</td></tr></tbody></table></div></article></div><details><summary>Show raw api</summary><pre style="max-width:100%;white-space:pre-wrap">{
    &quot;functions&quot;: [
        {
            &quot;name&quot;: &quot;createStore&quot;,
            &quot;desc&quot;: &quot;Factory function to create a new Store instance.\n\nInitializes the store context, sets up DataStore and MemoryStore connections\n(real or mock), validates the template schema, and returns the configured Store object.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;config&quot;,
                    &quot;desc&quot;: &quot;Configuration options for the store.&quot;,
                    &quot;lua_type&quot;: &quot;StoreConfig&lt;T&gt;&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;A new, initialized Store instance.&quot;,
                    &quot;lua_type&quot;: &quot;Store&lt;T&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;static&quot;,
            &quot;source&quot;: {
                &quot;line&quot;: 217,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;load&quot;,
            &quot;desc&quot;: &quot;Acquires a distributed lock, loads data for the given key into memory, \nand establishes a `Session` object to manage the key&#x27;s state.\n\nThis must be called before performing operations like `get`, `update`, or `save`\non the key. It handles concurrent load attempts and waits for any ongoing unload\noperations to complete first.\n\nPropagates errors from `Session.load` (e.g., lock acquisition failure, DataStore errors).&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The unique identifier for the data to load (e.g., \&quot;player_123\&quot;).&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                },
                {
                    &quot;name&quot;: &quot;userIds&quot;,
                    &quot;desc&quot;: &quot;Optional list of UserIDs for DataStore key tagging.&quot;,
                    &quot;lua_type&quot;: &quot;{number}?&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves when the data is successfully loaded and the session is ready, or rejects on error.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Load already in progress\&quot;&quot;,
                    &quot;desc&quot;: &quot;If `load` is called again for the same key while a previous load is still running.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the store instance has been closed via `close()`.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 351,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;loadAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:load]. Waits for the Promise to settle.\nThrows an error if the load fails or is cancelled.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The unique identifier for the data to load.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                },
                {
                    &quot;name&quot;: &quot;userIds&quot;,
                    &quot;desc&quot;: &quot;Optional list of UserIDs for DataStore key tagging.&quot;,
                    &quot;lua_type&quot;: &quot;{number}?&quot;
                }
            ],
            &quot;returns&quot;: [],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;any&quot;,
                    &quot;desc&quot;: &quot;Throws any error encountered during the load process.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 460,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;unload&quot;,
            &quot;desc&quot;: &quot;Unloads data for the given key from memory, saves any pending changes,\nreleases the distributed lock, and ends the session.\n\nPropagates errors from `Session:unload` (e.g., save failures).&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The unique identifier for the data to unload.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves when the data is successfully unloaded, or rejects on error.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the store instance has been closed.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 475,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;unloadAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:unload]. Waits for the Promise to settle.\nThrows an error if the unload fails.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The unique identifier for the data to unload.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;any&quot;,
                    &quot;desc&quot;: &quot;Throws any error encountered during the unload process.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 529,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;_withSession&quot;,
            &quot;desc&quot;: &quot;Internal helper function to safely access the session for a given key.\nHandles waiting for load/unload operations and checks store/session state.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose session is needed.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                },
                {
                    &quot;name&quot;: &quot;callback&quot;,
                    &quot;desc&quot;: &quot;The function to execute with the session object.&quot;,
                    &quot;lua_type&quot;: &quot;(session: Session.Session&lt;any&gt;) -&gt; any&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with the return value of the callback, or rejects if the session cannot be accessed (e.g., not loaded, store closed, load cancelled).&quot;,
                    &quot;lua_type&quot;: &quot;Promise&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 543,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;_getKeyInfo&quot;,
            &quot;desc&quot;: &quot;Internal helper to get the DataStoreKeyInfo for a loaded key&#x27;s session.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose info is needed.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with the key info object, or nil if the session doesn&#x27;t have key info (shouldn&#x27;t normally happen for loaded sessions). Rejects if the session cannot be accessed.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;DataStoreKeyInfo?&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 596,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;get&quot;,
            &quot;desc&quot;: &quot;Gets the current, in-memory data state for the given key.\nRequires the key to be loaded first via `load()`.\nIf the key is still loading, this will wait for it to finish.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose data to retrieve.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with the current data object (potentially a deep copy).&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;T&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key not loaded\&quot;&quot;,
                    &quot;desc&quot;: &quot;If `load()` has not been successfully called for this key.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the store has been closed.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 614,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;getAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:get]. Waits for the Promise to settle.\nThrows an error if getting the data fails.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose data to retrieve.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;The current data object.&quot;,
                    &quot;lua_type&quot;: &quot;T&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key not loaded\&quot;&quot;,
                    &quot;desc&quot;: &quot;If `load()` has not been successfully called for this key.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the store has been closed.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 633,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;update&quot;,
            &quot;desc&quot;: &quot;Applies changes to the data for a given key using a transform function.\n\nThe `transformFunction` receives the current data and can modify it directly.\nIt **must** return `true` to indicate that changes were made and should be\nsaved, or `false` to abort the update without saving.\n\nChanges are applied optimistically to the in-memory state first and then queued\nfor saving to the DataStore.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose data to update.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                },
                {
                    &quot;name&quot;: &quot;transformFunction&quot;,
                    &quot;desc&quot;: &quot;A function that receives the current data and returns `true` to commit changes or `false` to abort.&quot;,
                    &quot;lua_type&quot;: &quot;(data: T) -&gt; boolean&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with `true` if the transform function returned `true` and the update was successfully queued, or `false` if the transform function returned `false`. Rejects on errors like key not loaded, store closed, or schema validation failure after transformation.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;boolean&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key not loaded\&quot;&quot;,
                    &quot;desc&quot;: &quot;If `load()` has not been successfully called for this key.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the store instance has been closed.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Schema validation failed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the data returned by `transformFunction` does not pass the store&#x27;s schema check.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 655,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;updateAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:update]. Waits for the Promise to settle.\nThrows an error if the update fails.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose data to update.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                },
                {
                    &quot;name&quot;: &quot;transformFunction&quot;,
                    &quot;desc&quot;: &quot;The transformation function.&quot;,
                    &quot;lua_type&quot;: &quot;(data: T) -&gt; boolean&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Returns the boolean value returned by the `transformFunction`.&quot;,
                    &quot;lua_type&quot;: &quot;boolean&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key not loaded\&quot;&quot;,
                    &quot;desc&quot;: &quot;If `load()` has not been successfully called for this key.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the store instance has been closed.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Schema validation failed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the data returned by `transformFunction` does not pass the store&#x27;s schema check.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 678,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;updateImmutable&quot;,
            &quot;desc&quot;: &quot;Applies changes to the data for a given key using a transform function,\nwith immutable copy-on-write semantics.\n\nThe `transformFunction` receives the current data but frozen (immutable),\nand cannot modify it directly. Instead, it should return new data that\nreflects the desired changes. Otherwise it should return `false` to abort\nthe update without saving.\n\nChanges are applied optimistically to the in-memory state first and then queued\nfor saving to the DataStore.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose data to update.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                },
                {
                    &quot;name&quot;: &quot;transformFunction&quot;,
                    &quot;desc&quot;: &quot;A function that receives the current data and returns a new copy of the data with changes to commit changes, or `false` to abort.&quot;,
                    &quot;lua_type&quot;: &quot;(data: T) -&gt; T | false&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with `true` if the transform function committed and the update was successfully queued, or `false` if the transform function returned `false`. Rejects on errors like key not loaded, store closed, or schema validation failure after transformation.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;boolean&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key not loaded\&quot;&quot;,
                    &quot;desc&quot;: &quot;If `load()` has not been successfully called for this key.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the store instance has been closed.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Schema validation failed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the data returned by `transformFunction` does not pass the store&#x27;s schema check.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 702,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;updateImmutableAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:updateImmutable]. Waits for the Promise to settle.\nThrows an error if the update fails.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose data to update.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                },
                {
                    &quot;name&quot;: &quot;transformFunction&quot;,
                    &quot;desc&quot;: &quot;The transformation function.&quot;,
                    &quot;lua_type&quot;: &quot;(data: T) -&gt; T | false&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Returns `true` if the update was successful, or `false` if the transform function returned `false`.&quot;,
                    &quot;lua_type&quot;: &quot;boolean&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key not loaded\&quot;&quot;,
                    &quot;desc&quot;: &quot;If `load()` has not been successfully called for this key.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the store instance has been closed.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Schema validation failed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the data returned by `transformFunction` does not pass the store&#x27;s schema check.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 725,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;txInternal&quot;,
            &quot;desc&quot;: &quot;Internal helper to perform transaction logic on multiple keys.\nHandles acquiring locks, validating state, and committing changes atomically\nvia a two-phase commit process.\n\nSupports both immutable and mutable transactions, where `immutable` controls\nwhether the data passed to the `transformFunction` is a deep copy (mutable)\nor a reference to the canonical, frozen data (immutable).\n\n**Implementation Details:**\n- Uses `PromiseQueue.multiQueueAdd` to ensure the transform function only runs\n  when all involved session queues are ready.\n- Uses a temporary `txLockPromise` on sessions to block concurrent `update` calls\n  while the transaction logic is executing.\n- Performs a two-phase commit using a transaction marker in the `txStore`:\n\t1. Write `false` to `txStore` under a unique `txId`.\n\t2. Update all primary `recordStore` entries with the new data and `txId`.\n\t3. If successful, remove the `txId` entry from `txStore`.\n- If any step fails, attempts to revert changes by rewriting records without the `txId`\n  and removing the `txId` marker.\n- Uses `JsonPatch` to calculate differences for efficient storage in `TxInfo`.\n\nPropagates DataStore errors encountered during the commit or revert phases.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;self&quot;,
                    &quot;desc&quot;: &quot;&quot;,
                    &quot;lua_type&quot;: &quot;Store&lt;T&gt;&quot;
                },
                {
                    &quot;name&quot;: &quot;keys&quot;,
                    &quot;desc&quot;: &quot;An array of keys involved in the transaction.&quot;,
                    &quot;lua_type&quot;: &quot;{string}&quot;
                },
                {
                    &quot;name&quot;: &quot;transformFunction&quot;,
                    &quot;desc&quot;: &quot;A function that receives the current state of all keys and, depending on `immutable`, either modifies it directly (mutable) and returns `true` to commit, or returns a new state (immutable) to commit. Must return `false` to abort the transaction.&quot;,
                    &quot;lua_type&quot;: &quot;((state: { [string]: any }) -&gt; boolean) | ((state: { [string]: any }) -&gt; { [string]: any } | false)&quot;
                },
                {
                    &quot;name&quot;: &quot;immutable&quot;,
                    &quot;desc&quot;: &quot;&quot;,
                    &quot;lua_type&quot;: &quot;boolean\n&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with `true` if the transaction was successful, or `false` if it was aborted. Rejects on error.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&quot;
                }
            ],
            &quot;function_type&quot;: &quot;static&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key not loaded\&quot;&quot;,
                    &quot;desc&quot;: &quot;If any key in the `keys` array has not been loaded.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key is already locked by another transaction\&quot;&quot;,
                    &quot;desc&quot;: &quot;If any key is already involved in an ongoing `tx`.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If any involved session has been closed (e.g., due to lock loss).&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the store instance has been closed.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Schema validation failed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the data for any key after transformation fails the schema check.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Keys changed in transaction\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the `transformFunction` attempts to add or remove keys from the state table it receives.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 764,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;tx&quot;,
            &quot;desc&quot;: &quot;Performs an atomic transaction across multiple keys.\n\nRequires the keys to be loaded first via `load()`. The `transformFunction`\nis called with the current state of all involved keys and must return `true`\nto commit changes or `false` to abort.\n\nPropagates errors from the transaction process, including DataStore errors,\nschema validation failures, and key loading issues.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;keys&quot;,
                    &quot;desc&quot;: &quot;An array of keys involved in the transaction.&quot;,
                    &quot;lua_type&quot;: &quot;{string}&quot;
                },
                {
                    &quot;name&quot;: &quot;transformFunction&quot;,
                    &quot;desc&quot;: &quot;The transformation function.&quot;,
                    &quot;lua_type&quot;: &quot;(state: { [string]: T }) -&gt; boolean&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with `true` if the transaction was successful, or `false` if it was aborted. Rejects on error.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;boolean&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key not loaded\&quot;&quot;,
                    &quot;desc&quot;: &quot;If any key in the `keys` array has not been loaded.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key is already locked by another transaction\&quot;&quot;,
                    &quot;desc&quot;: &quot;If any key is already involved in an ongoing `tx`.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If any involved session has been closed (e.g., due to lock loss).&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the store instance has been closed.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Schema validation failed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the data for any key after transformation fails the schema check.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Keys changed in transaction\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the `transformFunction` attempts to add or remove keys from the state table it receives.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 1087,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;txAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:tx]. Waits for the Promise to settle.\nThrows an error if the transaction fails or is aborted.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;keys&quot;,
                    &quot;desc&quot;: &quot;An array of keys involved in the transaction.&quot;,
                    &quot;lua_type&quot;: &quot;{string}&quot;
                },
                {
                    &quot;name&quot;: &quot;transformFunction&quot;,
                    &quot;desc&quot;: &quot;The transformation function.&quot;,
                    &quot;lua_type&quot;: &quot;(state: { [string]: T }) -&gt; boolean&quot;
                }
            ],
            &quot;returns&quot;: [],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;any&quot;,
                    &quot;desc&quot;: &quot;Throws any error encountered during the transaction.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 1104,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;txImmutable&quot;,
            &quot;desc&quot;: &quot;Performs an atomic transaction across multiple keys with immutable, copy-on-write semantics.\n\nThe data passed to the function is frozen and cannot be modified directly.\nInstead, the function should return a new table with the desired changes.\n\nRequires the keys to be loaded first via `load()`. The `transformFunction`\nis called with the current state of all involved keys and must return the\nnew state to commit or `false` to abort.\n\nPropagates errors from the transaction process, including DataStore errors,\nschema validation failures, and key loading issues.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;keys&quot;,
                    &quot;desc&quot;: &quot;An array of keys involved in the transaction.&quot;,
                    &quot;lua_type&quot;: &quot;{string}&quot;
                },
                {
                    &quot;name&quot;: &quot;transformFunction&quot;,
                    &quot;desc&quot;: &quot;The transformation function.&quot;,
                    &quot;lua_type&quot;: &quot;(state: { [string]: T }) -&gt; { [string]: T } | false&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with `true` if the transaction was successful, or `false` if it was aborted. Rejects on error.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;boolean&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key not loaded\&quot;&quot;,
                    &quot;desc&quot;: &quot;If any key in the `keys` array has not been loaded.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key is already locked by another transaction\&quot;&quot;,
                    &quot;desc&quot;: &quot;If any key is already involved in an ongoing `tx`.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If any involved session has been closed (e.g., due to lock loss).&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the store instance has been closed.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Schema validation failed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the data for any key after transformation fails the schema check.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Keys changed in transaction\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the `transformFunction` attempts to add or remove keys from the state table it receives.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 1132,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;txImmutableAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:txImmutable]. Waits for the Promise to settle.\nThrows an error if the transaction fails or is aborted.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;keys&quot;,
                    &quot;desc&quot;: &quot;An array of keys involved in the transaction.&quot;,
                    &quot;lua_type&quot;: &quot;{string}&quot;
                },
                {
                    &quot;name&quot;: &quot;transformFunction&quot;,
                    &quot;desc&quot;: &quot;The transformation function.&quot;,
                    &quot;lua_type&quot;: &quot;(state: { [string]: T }) -&gt; { [string]: T } | false&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;&quot;,
                    &quot;lua_type&quot;: &quot;boolean\n&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;any&quot;,
                    &quot;desc&quot;: &quot;Throws any error encountered during the transaction.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 1152,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;save&quot;,
            &quot;desc&quot;: &quot;Forces an immediate save of the given key&#x27;s current in-memory data state\nto the DataStore.\n\n:::note\nData is automatically saved periodically by the Session&#x27;s autosave mechanism.\nManual saves are typically only needed in specific scenarios like processing\ndeveloper product purchases (`MarketplaceService.ProcessReceipt`) where immediate\npersistence is crucial before granting benefits.\n:::\n\nPropagates errors from `Session:save` (e.g., DataStore write errors).&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose data to save.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves when the save operation completes successfully, rejects on error.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Key not loaded\&quot;&quot;,
                    &quot;desc&quot;: &quot;If `load()` has not been successfully called for this key.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the store instance has been closed.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 1178,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;saveAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:save]. Waits for the Promise to settle.\nThrows an error if the save fails.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose data to save.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;any&quot;,
                    &quot;desc&quot;: &quot;Throws any error encountered during the save operation.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 1195,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;close&quot;,
            &quot;desc&quot;: &quot;Closes the store, gracefully unloading all active sessions.\n\nAttempts to save any pending changes for all loaded keys before releasing locks\nand removing sessions from memory. The store instance becomes unusable as soon as this is called.&quot;,
            &quot;params&quot;: [],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves when all sessions have attempted to unload, or rejects if any session encountered an error during its unload process (errors are aggregated).&quot;,
                    &quot;lua_type&quot;: &quot;Promise&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;source&quot;: {
                &quot;line&quot;: 1208,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;closeAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:close]. Waits for the Promise to settle.\nThrows an error if closing fails (i.e., if any session failed to unload).&quot;,
            &quot;params&quot;: [],
            &quot;returns&quot;: [],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;any&quot;,
                    &quot;desc&quot;: &quot;Throws an error (potentially a table of errors) if closing fails.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 1261,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;peek&quot;,
            &quot;desc&quot;: &quot;Reads the current data for the given key directly from the DataStore,\nbypassing the session cache and locking mechanism.\n\nThis provides a snapshot of the last saved state but does not load the key\ninto an active session. Useful for inspecting data without acquiring a lock.\nHandles potential sharding and transaction status automatically.\n\nPropagates DataStore errors from underlying reads.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose data to peek at.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with the data object, or `nil` if the key doesn&#x27;t exist. Rejects on DataStore errors.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;T?&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;source&quot;: {
                &quot;line&quot;: 1279,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;peekAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:peek]. Waits for the Promise to settle.\nReturns the data for the key if it exists. Throws on any errors from underlying DataStore operations.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose data to peek at.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;The data object, or `nil` if the key doesn&#x27;t exist.&quot;,
                    &quot;lua_type&quot;: &quot;T?&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;any&quot;,
                    &quot;desc&quot;: &quot;May throw errors from underlying DataStore operations.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 1327,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;probeLockActive&quot;,
            &quot;desc&quot;: &quot;Checks if a distributed lock is currently active for the given key in MemoryStore.\n\nPropagates errors from `Locks.probeLockActive`.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key to check the lock status for.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with `true` if a lock is active, `false` otherwise. Rejects on MemoryStore errors.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;boolean&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;source&quot;: {
                &quot;line&quot;: 1340,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;probeLockActiveAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:probeLockActive]. Waits for the Promise to settle.\nThrows an error if the check fails.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key to check the lock status for.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;`true` if a lock is active, `false` otherwise.&quot;,
                    &quot;lua_type&quot;: &quot;boolean&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;any&quot;,
                    &quot;desc&quot;: &quot;Throws any error encountered during the probe operation.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 1358,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;listVersions&quot;,
            &quot;desc&quot;: &quot;Lists historical versions of the data for a given key using DataStore versioning.\n\nPropagates errors from `DataStore:ListVersionsAsync`.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;params&quot;,
                    &quot;desc&quot;: &quot;Parameters specifying the key, sorting, date range, and page size.&quot;,
                    &quot;lua_type&quot;: &quot;ListVersionParams&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with an iterator object (`DataStoreVersionPages`) that can be used to fetch pages of version history. Rejects on DataStore errors.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;DataStoreVersionPages&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;source&quot;: {
                &quot;line&quot;: 1371,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;listVersionsAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:listVersions]. Waits for the Promise to settle.\nThrows an error if listing versions fails.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;params&quot;,
                    &quot;desc&quot;: &quot;Parameters for listing versions.&quot;,
                    &quot;lua_type&quot;: &quot;ListVersionParams&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;An iterator for version history.&quot;,
                    &quot;lua_type&quot;: &quot;DataStoreVersionPages&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;any&quot;,
                    &quot;desc&quot;: &quot;Throws any error encountered during the list operation.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 1394,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;readVersion&quot;,
            &quot;desc&quot;: &quot;Reads the data content of a specific historical version for a given key.\n\nPropagates DataStore errors from underlying reads.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose version to read.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                },
                {
                    &quot;name&quot;: &quot;version&quot;,
                    &quot;desc&quot;: &quot;The specific version ID (obtained from `listVersions`).&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with the data object (`T`) and the `DataStoreKeyInfo` for that version. Rejects if the version doesn&#x27;t exist or on DataStore/read errors.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;(T, DataStoreKeyInfo)&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Record not found\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the specified version doesn&#x27;t exist.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 1409,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;readVersionAsync&quot;,
            &quot;desc&quot;: &quot;Synchronous wrapper for [Store:readVersion]. Waits for the Promise to settle.\nThrows an error if reading the version fails.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;desc&quot;: &quot;The key whose version to read.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                },
                {
                    &quot;name&quot;: &quot;version&quot;,
                    &quot;desc&quot;: &quot;The specific version ID.&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;The data object for the specified version.&quot;,
                    &quot;lua_type&quot;: &quot;T&quot;
                },
                {
                    &quot;desc&quot;: &quot;The key info for the specified version.&quot;,
                    &quot;lua_type&quot;: &quot;DataStoreKeyInfo&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;any&quot;,
                    &quot;desc&quot;: &quot;Throws any error encountered during the read operation.&quot;
                }
            ],
            &quot;yields&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 1453,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        }
    ],
    &quot;properties&quot;: [],
    &quot;types&quot;: [
        {
            &quot;name&quot;: &quot;StoreConfig&quot;,
            &quot;desc&quot;: &quot;Configuration options for creating a new Store instance using `createStore`.&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;name&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;,
                    &quot;desc&quot;: &quot;A unique name for this store (e.g., \&quot;PlayerDataProd\&quot;). Used for logging and deriving DataStore/MemoryStore keys.&quot;
                },
                {
                    &quot;name&quot;: &quot;template&quot;,
                    &quot;lua_type&quot;: &quot;T&quot;,
                    &quot;desc&quot;: &quot;A deep copyable Luau table/value representing the default state for a new key.&quot;
                },
                {
                    &quot;name&quot;: &quot;schema&quot;,
                    &quot;lua_type&quot;: &quot;(value: any) -&gt; (boolean, string?)&quot;,
                    &quot;desc&quot;: &quot;A validation function (e.g., created with `t`) that checks if data conforms to the expected structure. Returns `true` if valid, or `false` and an error message if invalid.&quot;
                },
                {
                    &quot;name&quot;: &quot;migrationSteps&quot;,
                    &quot;lua_type&quot;: &quot;{Types.MigrationStep}?&quot;,
                    &quot;desc&quot;: &quot;An optional ordered list of migration steps to apply to data loaded from the DataStore if its schema is older than the current version. See `Migrations.luau`.&quot;
                },
                {
                    &quot;name&quot;: &quot;importLegacyData&quot;,
                    &quot;lua_type&quot;: &quot;((key: string) -&gt; any?)?&quot;,
                    &quot;desc&quot;: &quot;An optional function to load data from a different, legacy storage system when a key is accessed for the first time and doesn&#x27;t exist in this store.&quot;
                },
                {
                    &quot;name&quot;: &quot;dataStoreService&quot;,
                    &quot;lua_type&quot;: &quot;DataStoreService?&quot;,
                    &quot;desc&quot;: &quot;An optional override for the Roblox DataStoreService. Useful for testing or custom storage implementations. Defaults to `game:GetService(\&quot;DataStoreService\&quot;)`.&quot;
                },
                {
                    &quot;name&quot;: &quot;memoryStoreService&quot;,
                    &quot;lua_type&quot;: &quot;MemoryStoreService?&quot;,
                    &quot;desc&quot;: &quot;An optional override for the Roblox MemoryStoreService. Useful for testing. Defaults to `game:GetService(\&quot;MemoryStoreService\&quot;)`.&quot;
                },
                {
                    &quot;name&quot;: &quot;useMock&quot;,
                    &quot;lua_type&quot;: &quot;boolean?&quot;,
                    &quot;desc&quot;: &quot;If true (and running in Studio), uses mock in-memory implementations of DataStoreService and MemoryStoreService instead of the actual Roblox services. Useful for testing in a controlled environment. Defaults to `false`.&quot;
                },
                {
                    &quot;name&quot;: &quot;changedCallbacks&quot;,
                    &quot;lua_type&quot;: &quot;{ (key: string, newData: T, oldData: T?) -&gt; () }?&quot;,
                    &quot;desc&quot;: &quot;An optional list of functions called *after* data for a key has been successfully updated. Provides the key, the new data state, and the previous data state (if available).&quot;
                },
                {
                    &quot;name&quot;: &quot;logCallback&quot;,
                    &quot;lua_type&quot;: &quot;((logMessage: Log.LogMessage) -&gt; ())?&quot;,
                    &quot;desc&quot;: &quot;A function to receive log messages generated by this Store instance and its components. If omitted, logs are discarded. See [Log].&quot;
                },
                {
                    &quot;name&quot;: &quot;onLockLost&quot;,
                    &quot;lua_type&quot;: &quot;((key: string) -&gt; ())?&quot;,
                    &quot;desc&quot;: &quot;An optional callback function triggered if the distributed lock for a key&#x27;s session is lost unexpectedly (e.g., due to expiration or external interference). This usually indicates the session is no longer safe to use.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 97,
                &quot;path&quot;: &quot;src/Store.luau&quot;
            }
        }
    ],
    &quot;name&quot;: &quot;Store&quot;,
    &quot;desc&quot;: &quot;Coordinates Sessions and provides a safe, high-level API for interacting with\npersistent data stored in Roblox DataStores and MemoryStores.\n\n**Core Responsibilities:**\n- Manages the lifecycle of `Session` objects for individual data keys (e.g., player IDs).\n- Provides methods for loading, reading (`get`), updating (`update`), and saving data.\n- Implements atomic multi-key transactions (`tx`).\n- Handles data validation, migrations, and optional legacy data import.\n- Abstracts away underlying complexities like data sharding (`Files`), distributed\n  locking (`Locks`), and transaction coordination (`Transactions`).\n- Integrates with a configurable logging system (`Log`).\n\n**Usage Example:**\n```lua\nlocal store = Store.createStore({\n\tname = \&quot;PlayerData\&quot;,\n\ttemplate = {\n\t\tcoins = 0,\n\t\titems = {},\n\t},\n\tschema = function(data)\n\t\treturn typeof(data.coins) == \&quot;number\&quot; and typeof(data.items) == \&quot;table\&quot;,\n\t\t\&quot;Invalid data format\&quot;\n\tend,\n\t-- ... other config options\n})\n\n-- Load data for a player\nstore:load(\&quot;player_1\&quot;):andThen(function()\n\t-- Get current data\n\treturn store:get(\&quot;player_1\&quot;)\nend):andThen(function(data)\n\tprint(data.coins) -- 0\n\n\t-- Update data\n\treturn store:update(\&quot;player_1\&quot;, function(data)\n\t\tdata.coins += 100\n\t\treturn true -- Must return true to commit changes\n\tend)\nend)\n```&quot;,
    &quot;private&quot;: true,
    &quot;source&quot;: {
        &quot;line&quot;: 47,
        &quot;path&quot;: &quot;src/Store.luau&quot;
    }
}</pre></details></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#types" class="table-of-contents__link toc-highlight">Types</a><ul><li><a href="#StoreConfig" class="table-of-contents__link toc-highlight">StoreConfig</a></li></ul></li><li><a href="#functions" class="table-of-contents__link toc-highlight">Functions</a><ul><li><a href="#close" class="table-of-contents__link toc-highlight">:close</a></li><li><a href="#closeAsync" class="table-of-contents__link toc-highlight">:closeAsync</a></li><li><a href="#get" class="table-of-contents__link toc-highlight">:get</a></li><li><a href="#getAsync" class="table-of-contents__link toc-highlight">:getAsync</a></li><li><a href="#listVersions" class="table-of-contents__link toc-highlight">:listVersions</a></li><li><a href="#listVersionsAsync" class="table-of-contents__link toc-highlight">:listVersionsAsync</a></li><li><a href="#load" class="table-of-contents__link toc-highlight">:load</a></li><li><a href="#loadAsync" class="table-of-contents__link toc-highlight">:loadAsync</a></li><li><a href="#peek" class="table-of-contents__link toc-highlight">:peek</a></li><li><a href="#peekAsync" class="table-of-contents__link toc-highlight">:peekAsync</a></li><li><a href="#probeLockActive" class="table-of-contents__link toc-highlight">:probeLockActive</a></li><li><a href="#probeLockActiveAsync" class="table-of-contents__link toc-highlight">:probeLockActiveAsync</a></li><li><a href="#readVersion" class="table-of-contents__link toc-highlight">:readVersion</a></li><li><a href="#readVersionAsync" class="table-of-contents__link toc-highlight">:readVersionAsync</a></li><li><a href="#save" class="table-of-contents__link toc-highlight">:save</a></li><li><a href="#saveAsync" class="table-of-contents__link toc-highlight">:saveAsync</a></li><li><a href="#tx" class="table-of-contents__link toc-highlight">:tx</a></li><li><a href="#txAsync" class="table-of-contents__link toc-highlight">:txAsync</a></li><li><a href="#txImmutable" class="table-of-contents__link toc-highlight">:txImmutable</a></li><li><a href="#txImmutableAsync" class="table-of-contents__link toc-highlight">:txImmutableAsync</a></li><li><a href="#unload" class="table-of-contents__link toc-highlight">:unload</a></li><li><a href="#unloadAsync" class="table-of-contents__link toc-highlight">:unloadAsync</a></li><li><a href="#update" class="table-of-contents__link toc-highlight">:update</a></li><li><a href="#updateAsync" class="table-of-contents__link toc-highlight">:updateAsync</a></li><li><a href="#updateImmutable" class="table-of-contents__link toc-highlight">:updateImmutable</a></li><li><a href="#updateImmutableAsync" class="table-of-contents__link toc-highlight">:updateImmutableAsync</a></li><li><a href="#createStore" class="table-of-contents__link toc-highlight">.createStore</a></li><li><a href="#txInternal" class="table-of-contents__link toc-highlight">.txInternal</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/paradoxum-games/lyra" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with Moonwave and Docusaurus</div></div></div></footer></div>
</body>
</html>