<!doctype html>
<html lang="en" dir="ltr" class="plugin-moonwave plugin-id-moonwave" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Session | Lyra</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://paradoxum-games.github.io/lyra/api/Session"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="Session | Lyra"><meta data-rh="true" name="description" content="Manages the in-memory state and persistence lifecycle for a single data key
within a Store. A Session represents an active, locked instance of a key&#x27;s
data, coordinating data loading, saving, updates, transactions, migrations,
and cleanup.

Sessions are created internally by [Store:load] after acquiring a distributed
lock via the Locks module. They handle:
- Loading initial data by reading the main record, file shards, and pending
  transactions, applying migrations, or importing legacy data.
- Providing access to the current data ([Session:get]).
- Applying mutations ([Session:update]) safely within a `noYield` context and
  tracking changes.
- Saving changes back to DataStores ([Session:save], [Session:updateRecord], [Session:writeRecord]),
  potentially sharding large data via the Files module.
- Coordinating multi-key transactions ([Store:tx] interacts with Session state).
- Automatically saving data periodically ([Session:startAutosaving]).
- Cleaning up orphaned file shards in the background ([Session:orphanFile]).
- Gracefully unloading data ([Session:unload]), ensuring final saves and lock release.

A Session is intrinsically tied to a [Locks.LockHandle]. If the lock is lost,
the Session becomes &#x27;closed&#x27; and unusable, triggering cleanup."><meta data-rh="true" property="og:description" content="Manages the in-memory state and persistence lifecycle for a single data key
within a Store. A Session represents an active, locked instance of a key&#x27;s
data, coordinating data loading, saving, updates, transactions, migrations,
and cleanup.

Sessions are created internally by [Store:load] after acquiring a distributed
lock via the Locks module. They handle:
- Loading initial data by reading the main record, file shards, and pending
  transactions, applying migrations, or importing legacy data.
- Providing access to the current data ([Session:get]).
- Applying mutations ([Session:update]) safely within a `noYield` context and
  tracking changes.
- Saving changes back to DataStores ([Session:save], [Session:updateRecord], [Session:writeRecord]),
  potentially sharding large data via the Files module.
- Coordinating multi-key transactions ([Store:tx] interacts with Session state).
- Automatically saving data periodically ([Session:startAutosaving]).
- Cleaning up orphaned file shards in the background ([Session:orphanFile]).
- Gracefully unloading data ([Session:unload]), ensuring final saves and lock release.

A Session is intrinsically tied to a [Locks.LockHandle]. If the lock is lost,
the Session becomes &#x27;closed&#x27; and unusable, triggering cleanup."><link data-rh="true" rel="canonical" href="https://paradoxum-games.github.io/lyra/api/Session"><link data-rh="true" rel="alternate" href="https://paradoxum-games.github.io/lyra/api/Session" hreflang="en"><link data-rh="true" rel="alternate" href="https://paradoxum-games.github.io/lyra/api/Session" hreflang="x-default"><link rel="stylesheet" href="/lyra/assets/css/styles.f56ecc6a.css">
<script src="/lyra/assets/js/runtime~main.4a9be780.js" defer="defer"></script>
<script src="/lyra/assets/js/main.3498456b.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/lyra/"><b class="navbar__title text--truncate">Lyra</b></a><a class="navbar__item navbar__link" href="/lyra/docs/intro">Docs</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/lyra/api/">API</a><a class="navbar__item navbar__link" href="/lyra/changelog">Changelog</a></div><div class="navbar__items navbar__items--right"><a href="https://wally.run/package/paradoxum-games/lyra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Wally<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><a href="https://github.com/paradoxum-games/lyra" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input id="search_input_react" type="search" placeholder="Loading..." aria-label="Search" class="navbar__search-input search-bar" disabled=""></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docPageContainer_wNNk"><div class="docPage_Dpn1"><div class="docSidebarContainer_o_re"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lyra/api/PlayerStore">​Player​Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/lyra/api/Lyra">​Lyra</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/lyra/api/Store">Internal</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Store">​Store</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/lyra/api/Session">​Session</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Locks">​Locks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Constants">​Constants</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Files">​Files</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Log">​Log</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/PromiseQueue">​Promise​Queue</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Types">​Types</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Transactions">​Transactions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/Migrations">​Migrations</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/hashMapRetry">hash​Map​Retry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/lyra/api/dataStoreRetry">data​Store​Retry</a></li></ul></li></ul></nav></div></div><main class="docMainContainer_HJE1"><div class="container padding-vert--lg"><div class="row"><div class="col docItemCol_MU3C"><div class="docItemContainer_Wv98"><article><div class="member_J0w1 markdown"><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_oUs_"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><header><h1 class="docTitle_mZRt" style="text-decoration:none"><span style="display:inline-block">Session</span></h1><div class="luaClassTags_EipM"><span class="badge_Ba2I" style="color:#9b59b6"><span class="badgeTooltip_cWXP">This item is only intended to be used by the module&#x27;s authors.</span><span class="badgeToolTipTail_H9D_"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" fill="#9b59b6" role="img" aria-label="This item is only intended to be used by the module&#x27;s authors."><path d="m49.2 36 14.3 12.7.1-.7c0-6.7-6.1-12.1-13.6-12.1l-.8.1z"></path><path d="M50 27.8c12.5 0 22.7 9 22.7 20.1 0 2.6-.6 5-1.6 7.3L84.4 67c6.9-5 12.3-11.6 15.6-19.1-7.9-17.6-27.3-30.1-50-30.1-6.4 0-12.5 1-18.1 2.8l9.8 8.6c2.6-.8 5.4-1.4 8.3-1.4zM4.5 16.9l10.4 9.2 2.1 1.8C9.5 33.1 3.5 40 0 48c7.9 17.7 27.3 30.2 50 30.2 7 0 13.8-1.2 19.9-3.4l1.9 1.7 13.3 11.7 5.8-5.1-80.6-71.3-5.8 5.1zm25.2 22.2 7 6.2c-.2.8-.3 1.8-.3 2.6C36.4 54.6 42.5 60 50 60c1 0 2-.2 3-.3l7 6.2c-3 1.3-6.4 2.1-10 2.1-12.5 0-22.7-9-22.7-20.1 0-3.1.9-6.1 2.4-8.8z"></path></svg> <!-- -->Private</span></span></div><label class="privateToggle_lmfE"><span class="privateCheckboxContainer_psRa"><input class="privateCheckboxInternal_IKP2" type="checkbox" name="checkbox"><span class="privateCheckboxControl_Ov8U"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" aria-hidden="true" focusable="false"><path fill="none" stroke="currentColor" stroke-width="3" d="M4 11.91l5.37 5.37L19.79 5.59"></path></svg></span></span><span class="privateCheckboxLabel_Vmvs">Show Private</span></label><div>
<p>
  Manages the in-memory state and persistence lifecycle for a single data key
  within a Store. A Session represents an active, locked instance of a key's
  data, coordinating data loading, saving, updates, transactions, migrations,
  and cleanup.
</p>
<p>
  Sessions are created internally by <a href="/lyra/api/Store#load">Store:load</a> after acquiring a distributed
  lock via the Locks module. They handle:
</p>
<ul>
  <li>
    Loading initial data by reading the main record, file shards, and pending
    transactions, applying migrations, or importing legacy data.
  </li>
  <li>Providing access to the current data (<a href="/lyra/api/Session#get">Session:get</a>).</li>
  <li>
    Applying mutations (<a href="/lyra/api/Session#update">Session:update</a>) safely within a <code>noYield</code> context and
    tracking changes.
  </li>
  <li>
    Saving changes back to DataStores (<a href="/lyra/api/Session#save">Session:save</a>, <a href="/lyra/api/Session#updateRecord">Session:updateRecord</a>, <a href="/lyra/api/Session#writeRecord">Session:writeRecord</a>),
    potentially sharding large data via the Files module.
  </li>
  <li>Coordinating multi-key transactions (<a href="/lyra/api/Store#tx">Store:tx</a> interacts with Session state).</li>
  <li>Automatically saving data periodically (<a href="/lyra/api/Session#startAutosaving">Session:startAutosaving</a>).</li>
  <li>Cleaning up orphaned file shards in the background (<a href="/lyra/api/Session#orphanFile">Session:orphanFile</a>).</li>
  <li>Gracefully unloading data (<a href="/lyra/api/Session#unload">Session:unload</a>), ensuring final saves and lock release.</li>
</ul>
<p>
  A Session is intrinsically tied to a <a href="/lyra/api/Locks#LockHandle">Locks.LockHandle</a>. If the lock is lost,
  the Session becomes 'closed' and unusable, triggering cleanup.
</p>
</div></header><h2 class="anchor anchorWithStickyNavbar_LWe7" id="types">Types<a href="#types" class="hash-link" aria-label="Direct link to Types" title="Direct link to Types">​</a></h2><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="Session&lt;T&gt;"><code style="text-decoration:none">Session&lt;T&gt;</code><a href="#Session&lt;T&gt;" class="hash-link" aria-label="Direct link to Session&lt;T&gt;" title="Direct link to Session&lt;T&gt;">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Session.luau#L153"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code class="purple_ieR2">type</code> <code>Session&lt;T&gt;<!-- --> = </code> <code class="blue_P4bS">typeof(setmetatable(</code><code class="purple_ieR2">{</code><code class="purple_ieR2">}</code><code>:<!-- -->: </code><code class="blue_P4bS">SessionProps</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">T</code><code class="op_lSLc">&gt;</code><code class="blue_P4bS">,</code><code class="purple_ieR2">{</code><code class="purple_ieR2">}</code><code>:<!-- -->: </code><code class="blue_P4bS">SessionImpl</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">T</code><code class="op_lSLc">&gt;</code><code class="blue_P4bS">))</code></div><div>
<p>Represents an active, locked session for a specific data key.</p>
</div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="functions">Functions<a href="#functions" class="hash-link" aria-label="Direct link to Functions" title="Direct link to Functions">​</a></h2><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="load"><code style="text-decoration:none">load</code><a href="#load" class="hash-link" aria-label="Direct link to load" title="Direct link to load">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Session.luau#L473"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Session<!-- -->.</code><code class="green_DgR4">load</code><code>(</code><div class="inset_uKQm"><div><code>params<!-- -->: </code><code class="blue_P4bS">LoadSessionParams</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">T</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Parameters for loading the session.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS"><a style="text-decoration:underline;color:inherit" href="/lyra/api/Session">Session</a></code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">T</code><code class="op_lSLc">&gt;</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves with the new Session instance.</p>
</span></span></div><div>
<p>
  Static method to load data and create a Session. This is the main entry point
  called by <code>Store:load</code>.
</p>
<p>Steps:</p>
<ol>
  <li>Acquire the distributed lock for the key using <code>Locks.acquireLock</code>.</li>
  <li>If lock acquired, call the internal <code>load</code> helper function.</li>
  <li>If load successful and lock still held, create the Session instance using <code>createSession</code>.</li>
  <li>Set up lock loss handling (<code>lockHandle.onLockLost</code>) to close the session.</li>
  <li>Initiate background cleanup for any orphaned files found during load.</li>
  <li>Set the initial data in the session using <code>mutateKey</code>.</li>
  <li>Return the created Session.</li>
  <li>Ensure the lock is released if loading fails at any stage.</li>
</ol>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Lock was lost while loading key&quot;</td><td></td></tr><tr><td>string</td><td>Propagates errors from `Locks.acquireLock` or internal `load`.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="isSaved"><code style="text-decoration:none">isSaved</code><a href="#isSaved" class="hash-link" aria-label="Direct link to isSaved" title="Direct link to isSaved">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Session.luau#L765"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Session<!-- -->:</code><code class="green_DgR4">isSaved</code><code>(</code><code>) → </code><code class="blue_P4bS">boolean</code><span class="inlineDescription_G7Er">-- <span>
<p>True if there are no unsaved changes, false otherwise.</p>
</span></span></div><div>
<p>Checks if the session has any unsaved changes.</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="startAutosaving"><code style="text-decoration:none">startAutosaving</code><a href="#startAutosaving" class="hash-link" aria-label="Direct link to startAutosaving" title="Direct link to startAutosaving">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Session.luau#L816"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Session<!-- -->:</code><code class="green_DgR4">startAutosaving</code><code>(</code><code>) → </code><code>(</code><code>)</code></div><div>
<p>
  Starts the background autosave loop for this session.
  Does nothing if already started or if the session is closed.
</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="stopAutosaving"><code style="text-decoration:none">stopAutosaving</code><a href="#stopAutosaving" class="hash-link" aria-label="Direct link to stopAutosaving" title="Direct link to stopAutosaving">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Session.luau#L868"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Session<!-- -->:</code><code class="green_DgR4">stopAutosaving</code><code>(</code><code>) → </code><code>(</code><code>)</code></div><div>
<p>Stops the background autosave loop if it's running.</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="unload"><code style="text-decoration:none">unload</code><a href="#unload" class="hash-link" aria-label="Direct link to unload" title="Direct link to unload">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Session.luau#L884"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Session<!-- -->:</code><code class="green_DgR4">unload</code><code>(</code><code>) → </code><code class="blue_P4bS">Promise</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves when the unload process is complete.</p>
</span></span></div><div>
<p>
  Initiates the graceful shutdown process for the session.
  Stops autosaving, queues a final save operation, and releases the lock.
</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="get"><code style="text-decoration:none">get</code><a href="#get" class="hash-link" aria-label="Direct link to get" title="Direct link to get">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Session.luau#L927"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Session<!-- -->:</code><code class="green_DgR4">get</code><code>(</code><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">T</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves immediately with the frozen data.</p>
</span></span></div><div>
<p>Gets the current, immutable (frozen) data for the session.</p>
</div><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="update"><code style="text-decoration:none">update</code><a href="#update" class="hash-link" aria-label="Direct link to update" title="Direct link to update">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Session.luau#L943"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Session<!-- -->:</code><code class="green_DgR4">update</code><code>(</code><div class="inset_uKQm"><div><code>transformFunction<!-- -->: </code><code class="purple_ieR2">(</code><code>data<!-- -->: </code><code class="blue_P4bS">T</code><code class="purple_ieR2">)</code><code class="purple_ieR2"> → </code><code class="blue_P4bS">boolean</code><span class="inlineDescription_G7Er">-- <span>
<p>Function to modify data. Must return <code>true</code> to commit, <code>false</code> to abort.</p>
</span></span></div></div><code>) → </code><code class="blue_P4bS">Promise</code><code class="op_lSLc">&lt;</code><code class="blue_P4bS">boolean</code><code class="op_lSLc">&gt;</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves with <code>true</code> if changes were committed, <code>false</code> if aborted by the transform.</p>
</span></span></div><div>
<p>
  Applies updates to the session's data via a transform function.
  Ensures the transform runs without yielding and validates the result against the schema.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Session is closed&quot;</td><td></td></tr><tr><td>&quot;transformFunction failed: ...&quot;</td><td>If the transform function errors.</td></tr><tr><td>&quot;transformFunction must return a boolean&quot;</td><td></td></tr><tr><td>&quot;Store:update schema validation failed: ...&quot;</td><td>If the modified data fails schema validation.</td></tr></tbody></table><div class="divider_rE5g"></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="save"><code style="text-decoration:none">save</code><a href="#save" class="hash-link" aria-label="Direct link to save" title="Direct link to save">​</a></h3><div class="repositoryDetailsContainer_BPdw"><a class="sourceButton_sEho" href="https://github.com/paradoxum-games/lyra/blob/main/src/Session.luau#L1030"><div class="sourceButtonText_Vh0m">&lt;/&gt;</div></a></div><div class="memberString_GwaU"><code>Session<!-- -->:</code><code class="green_DgR4">save</code><code>(</code><code>) → </code><code class="blue_P4bS">Promise</code><span class="inlineDescription_G7Er">-- <span>
<p>Resolves when the save operation completes (or immediately if no changes).</p>
</span></span></div><div>
<p>
  Queues a save operation for the current session state if changes are pending.
  Uses the session's PromiseQueue to serialize saves.
</p>
</div><h3>Errors</h3><table class="errorTable_jfN8"><thead><tr><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>&quot;Session is closed&quot;</td><td></td></tr></tbody></table></div></article></div><details><summary>Show raw api</summary><pre style="max-width:100%;white-space:pre-wrap">{
    &quot;functions&quot;: [
        {
            &quot;name&quot;: &quot;load&quot;,
            &quot;desc&quot;: &quot;Internal helper function to perform the multi-stage loading process for a key.\nThis runs *after* the lock has been acquired.\n\nSteps:\n1. Get the main record from `recordStore`.\n2. Extract metadata (applied migrations, orphaned files).\n3. If a file reference exists, read the file data (potentially from shards via `Files.read`).\n4. If file data contains transaction info (`txInfo`), resolve the transaction state via `Transactions.readTx`.\n5. If no data found yet, attempt to import legacy data via `ctx.importLegacyData`.\n6. If still no data, use the `ctx.template` as the base.\n7. Apply any pending migrations via `Migrations.apply`.\n8. Return the final loaded data and metadata.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;params&quot;,
                    &quot;desc&quot;: &quot;Parameters for loading.&quot;,
                    &quot;lua_type&quot;: &quot;LoadParams&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Promise resolving with the loaded data and metadata.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;LoadResult&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;static&quot;,
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 230,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;createSession&quot;,
            &quot;desc&quot;: &quot;Internal factory function to create a new Session instance.\nInitializes the session state based on loaded data and acquired lock.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;params&quot;,
                    &quot;desc&quot;: &quot;Parameters for session creation.&quot;,
                    &quot;lua_type&quot;: &quot;CreateSessionParams&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;The newly created session instance.&quot;,
                    &quot;lua_type&quot;: &quot;Session&lt;T&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;static&quot;,
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 415,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;load&quot;,
            &quot;desc&quot;: &quot;Static method to load data and create a Session. This is the main entry point\ncalled by `Store:load`.\n\nSteps:\n1. Acquire the distributed lock for the key using `Locks.acquireLock`.\n2. If lock acquired, call the internal `load` helper function.\n3. If load successful and lock still held, create the Session instance using `createSession`.\n4. Set up lock loss handling (`lockHandle.onLockLost`) to close the session.\n5. Initiate background cleanup for any orphaned files found during load.\n6. Set the initial data in the session using `mutateKey`.\n7. Return the created Session.\n8. Ensure the lock is released if loading fails at any stage.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;params&quot;,
                    &quot;desc&quot;: &quot;Parameters for loading the session.&quot;,
                    &quot;lua_type&quot;: &quot;LoadSessionParams&lt;T&gt;&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with the new Session instance.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;Session&lt;T&gt;&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;static&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Lock was lost while loading key\&quot;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;string&quot;,
                    &quot;desc&quot;: &quot;Propagates errors from `Locks.acquireLock` or internal `load`.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 473,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;updateRecord&quot;,
            &quot;desc&quot;: &quot;Internal method to trigger a save operation if there are pending changes.\nThis is called by `Session:save` and `Session:unload`.&quot;,
            &quot;params&quot;: [],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves when the save is complete (or immediately if no changes).&quot;,
                    &quot;lua_type&quot;: &quot;Promise&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 562,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;orphanFile&quot;,
            &quot;desc&quot;: &quot;Marks a file (usually an older, sharded file) for deletion and starts a\nbackground task to remove its shards from the `shardStore`.\n\nHandles DataStore budget limitations by waiting if the budget is too low.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;file&quot;,
                    &quot;desc&quot;: &quot;The file metadata (must include `shard` and `count` if sharded).&quot;,
                    &quot;lua_type&quot;: &quot;Types.File&quot;
                }
            ],
            &quot;returns&quot;: [],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 590,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;writeRecord&quot;,
            &quot;desc&quot;: &quot;Core internal method responsible for writing the current session data to DataStores.\n\nSteps:\n1. Write the data (as `txInfo`) to potentially multiple shards using `Files.write`.\n2. If sharding fails, mark the failed shards as orphaned and reject.\n3. If file write succeeds, check if the session lock is still held.\n4. If lock lost, mark the newly written file as orphaned and reject.\n5. Prepare the main record (`DataStoreRecord`) containing metadata (migrations,\n   new file reference, list of files now orphaned by this save).\n6. Write the main record to the `recordStore` using SetAsync.\n7. If record write succeeds:\n\ta. Mark the *previous* `currentFile` (if any) as orphaned using `orphanFile`.\n\tb. Update `self.currentFile` to the newly written file reference.\n\tc. Return the written record.\n8. If record write fails, mark the newly written file as orphaned and reject.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;txInfo&quot;,
                    &quot;desc&quot;: &quot;The data payload to write (contains `committedData`).&quot;,
                    &quot;lua_type&quot;: &quot;Types.TxInfo&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with the written record on success.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;Types.DataStoreRecord&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;lock was lost while writing file\&quot;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;string&quot;,
                    &quot;desc&quot;: &quot;Propagates errors from `Files.write` or `SetAsync`.&quot;
                }
            ],
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 682,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;isSaved&quot;,
            &quot;desc&quot;: &quot;Checks if the session has any unsaved changes.&quot;,
            &quot;params&quot;: [],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;True if there are no unsaved changes, false otherwise.&quot;,
                    &quot;lua_type&quot;: &quot;boolean&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;source&quot;: {
                &quot;line&quot;: 765,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;setData&quot;,
            &quot;desc&quot;: &quot;Internal method to update the session&#x27;s in-memory data state.\nMarks the session as having unsaved changes and updates the frozen copy.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;data&quot;,
                    &quot;desc&quot;: &quot;The new data value.&quot;,
                    &quot;lua_type&quot;: &quot;any&quot;
                }
            ],
            &quot;returns&quot;: [],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 778,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;mutateKey&quot;,
            &quot;desc&quot;: &quot;Internal method called after data has been changed (either initially loaded or via `update`).\nUpdates the session state (`setData`) and triggers any configured `changedCallbacks`.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;newData&quot;,
                    &quot;desc&quot;: &quot;The new data value.&quot;,
                    &quot;lua_type&quot;: &quot;any&quot;
                }
            ],
            &quot;returns&quot;: [],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 796,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;startAutosaving&quot;,
            &quot;desc&quot;: &quot;Starts the background autosave loop for this session.\nDoes nothing if already started or if the session is closed.&quot;,
            &quot;params&quot;: [],
            &quot;returns&quot;: [],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;source&quot;: {
                &quot;line&quot;: 816,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;stopAutosaving&quot;,
            &quot;desc&quot;: &quot;Stops the background autosave loop if it&#x27;s running.&quot;,
            &quot;params&quot;: [],
            &quot;returns&quot;: [],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;source&quot;: {
                &quot;line&quot;: 868,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;unload&quot;,
            &quot;desc&quot;: &quot;Initiates the graceful shutdown process for the session.\nStops autosaving, queues a final save operation, and releases the lock.&quot;,
            &quot;params&quot;: [],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves when the unload process is complete.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;source&quot;: {
                &quot;line&quot;: 884,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;get&quot;,
            &quot;desc&quot;: &quot;Gets the current, immutable (frozen) data for the session.&quot;,
            &quot;params&quot;: [],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves immediately with the frozen data.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;T&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;source&quot;: {
                &quot;line&quot;: 927,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;update&quot;,
            &quot;desc&quot;: &quot;Applies updates to the session&#x27;s data via a transform function.\nEnsures the transform runs without yielding and validates the result against the schema.&quot;,
            &quot;params&quot;: [
                {
                    &quot;name&quot;: &quot;transformFunction&quot;,
                    &quot;desc&quot;: &quot;Function to modify data. Must return `true` to commit, `false` to abort.&quot;,
                    &quot;lua_type&quot;: &quot;(data: T) -&gt; boolean&quot;
                }
            ],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves with `true` if changes were committed, `false` if aborted by the transform.&quot;,
                    &quot;lua_type&quot;: &quot;Promise&lt;boolean&gt;&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Session is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;transformFunction failed: ...\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the transform function errors.&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;transformFunction must return a boolean\&quot;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;lua_type&quot;: &quot;\&quot;Store:update schema validation failed: ...\&quot;&quot;,
                    &quot;desc&quot;: &quot;If the modified data fails schema validation.&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 943,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;save&quot;,
            &quot;desc&quot;: &quot;Queues a save operation for the current session state if changes are pending.\nUses the session&#x27;s PromiseQueue to serialize saves.&quot;,
            &quot;params&quot;: [],
            &quot;returns&quot;: [
                {
                    &quot;desc&quot;: &quot;Resolves when the save operation completes (or immediately if no changes).&quot;,
                    &quot;lua_type&quot;: &quot;Promise&quot;
                }
            ],
            &quot;function_type&quot;: &quot;method&quot;,
            &quot;errors&quot;: [
                {
                    &quot;lua_type&quot;: &quot;\&quot;Session is closed\&quot;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                }
            ],
            &quot;source&quot;: {
                &quot;line&quot;: 1030,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        }
    ],
    &quot;properties&quot;: [],
    &quot;types&quot;: [
        {
            &quot;name&quot;: &quot;SessionImpl&lt;T&gt;&quot;,
            &quot;desc&quot;: &quot;Internal type definition for Session methods (used for metatable).\n\n\n-- Static method to load data and create a session\n\n-- Internal methods for saving data\n\n-- State checking\n\n-- Internal state mutation\n\n-- Autosave management\n\n-- Public API methods (called via Store)&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;__index&quot;,
                    &quot;lua_type&quot;: &quot;SessionImpl&lt;T&gt;&quot;,
                    &quot;desc&quot;: &quot;Metatable self-reference.&quot;
                },
                {
                    &quot;name&quot;: &quot;load&quot;,
                    &quot;lua_type&quot;: &quot;(params: LoadSessionParams&lt;T&gt;) -&gt; Promise&lt;Session&lt;T&gt;&gt;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;updateRecord&quot;,
                    &quot;lua_type&quot;: &quot;(self: Session&lt;T&gt;) -&gt; Promise&lt;any&gt;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;orphanFile&quot;,
                    &quot;lua_type&quot;: &quot;(self: Session&lt;T&gt;, file: Types.File) -&gt; ()&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;writeRecord&quot;,
                    &quot;lua_type&quot;: &quot;(self: Session&lt;T&gt;, txInfo: Types.TxInfo) -&gt; Promise&lt;any&gt;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;isSaved&quot;,
                    &quot;lua_type&quot;: &quot;(self: Session&lt;T&gt;) -&gt; boolean&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;setData&quot;,
                    &quot;lua_type&quot;: &quot;(self: Session&lt;T&gt;, data: T) -&gt; ()&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;mutateKey&quot;,
                    &quot;lua_type&quot;: &quot;(self: Session&lt;T&gt;, newData: T) -&gt; ()&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;startAutosaving&quot;,
                    &quot;lua_type&quot;: &quot;(self: Session&lt;T&gt;) -&gt; ()&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;stopAutosaving&quot;,
                    &quot;lua_type&quot;: &quot;(self: Session&lt;T&gt;) -&gt; ()&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;unload&quot;,
                    &quot;lua_type&quot;: &quot;(self: Session&lt;T&gt;) -&gt; Promise&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;get&quot;,
                    &quot;lua_type&quot;: &quot;(self: Session&lt;T&gt;) -&gt; Promise&lt;T&gt;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;update&quot;,
                    &quot;lua_type&quot;: &quot;(self: Session&lt;T&gt;, transformFunction: (data: T) -&gt; boolean) -&gt; Promise&lt;boolean&gt;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;save&quot;,
                    &quot;lua_type&quot;: &quot;(self: Session&lt;T&gt;) -&gt; Promise&quot;,
                    &quot;desc&quot;: &quot;&quot;
                }
            ],
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 78,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;SessionProps&lt;T&gt;&quot;,
            &quot;desc&quot;: &quot;Internal state properties of a Session instance.&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;_cleanupAutosave&quot;,
                    &quot;lua_type&quot;: &quot;(() -&gt; ())?&quot;,
                    &quot;desc&quot;: &quot;Function to stop the running autosave loop, if active.&quot;
                },
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;,
                    &quot;desc&quot;: &quot;The unique key this session manages.&quot;
                },
                {
                    &quot;name&quot;: &quot;ctx&quot;,
                    &quot;lua_type&quot;: &quot;Types.StoreContext&lt;T&gt;&quot;,
                    &quot;desc&quot;: &quot;Shared context from the parent Store.&quot;
                },
                {
                    &quot;name&quot;: &quot;lockHandle&quot;,
                    &quot;lua_type&quot;: &quot;Locks.LockHandle&quot;,
                    &quot;desc&quot;: &quot;The active distributed lock handle for this key.&quot;
                },
                {
                    &quot;name&quot;: &quot;userIds&quot;,
                    &quot;lua_type&quot;: &quot;{ number }?&quot;,
                    &quot;desc&quot;: &quot;User IDs associated with this session (primarily for SetAsync).&quot;
                },
                {
                    &quot;name&quot;: &quot;data&quot;,
                    &quot;lua_type&quot;: &quot;T?&quot;,
                    &quot;desc&quot;: &quot;The current, mutable in-memory data.&quot;
                },
                {
                    &quot;name&quot;: &quot;frozenData&quot;,
                    &quot;lua_type&quot;: &quot;T?&quot;,
                    &quot;desc&quot;: &quot;A deeply frozen, immutable copy of the data for safe external access (`get`).&quot;
                },
                {
                    &quot;name&quot;: &quot;appliedMigrations&quot;,
                    &quot;lua_type&quot;: &quot;{ string }&quot;,
                    &quot;desc&quot;: &quot;List of migration step names already applied to this data.&quot;
                },
                {
                    &quot;name&quot;: &quot;changeSet&quot;,
                    &quot;lua_type&quot;: &quot;{ [string]: true }&quot;,
                    &quot;desc&quot;: &quot;Tracks unsaved changes. Keys are unique mutation IDs, value is always true. Cleared on successful save.&quot;
                },
                {
                    &quot;name&quot;: &quot;orphanedFiles&quot;,
                    &quot;lua_type&quot;: &quot;{ Types.File }&quot;,
                    &quot;desc&quot;: &quot;List of file shards (from previous saves) marked for deletion.&quot;
                },
                {
                    &quot;name&quot;: &quot;currentFile&quot;,
                    &quot;lua_type&quot;: &quot;Types.File?&quot;,
                    &quot;desc&quot;: &quot;Reference to the current file structure (potentially sharded) representing the saved state.&quot;
                },
                {
                    &quot;name&quot;: &quot;queue&quot;,
                    &quot;lua_type&quot;: &quot;PromiseQueue.PromiseQueue&quot;,
                    &quot;desc&quot;: &quot;PromiseQueue to serialize save/unload/tx operations for this key.&quot;
                },
                {
                    &quot;name&quot;: &quot;txLockPromise&quot;,
                    &quot;lua_type&quot;: &quot;Promise?&quot;,
                    &quot;desc&quot;: &quot;A promise used during multi-key transactions (`Store:tx`) to block concurrent `Session:update` calls on this key until the transaction completes.&quot;
                },
                {
                    &quot;name&quot;: &quot;closed&quot;,
                    &quot;lua_type&quot;: &quot;boolean&quot;,
                    &quot;desc&quot;: &quot;Flag indicating if the session is closed (e.g., lock lost, unloaded).&quot;
                },
                {
                    &quot;name&quot;: &quot;unloadPromise&quot;,
                    &quot;lua_type&quot;: &quot;Promise?&quot;,
                    &quot;desc&quot;: &quot;Promise tracking an ongoing unload operation.&quot;
                },
                {
                    &quot;name&quot;: &quot;keyInfo&quot;,
                    &quot;lua_type&quot;: &quot;DataStoreKeyInfo?&quot;,
                    &quot;desc&quot;: &quot;DataStoreKeyInfo obtained during the initial load.&quot;
                },
                {
                    &quot;name&quot;: &quot;logger&quot;,
                    &quot;lua_type&quot;: &quot;Log.Logger&quot;,
                    &quot;desc&quot;: &quot;Logger instance specific to this session (includes key).&quot;
                }
            ],
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 127,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;Session&lt;T&gt;&quot;,
            &quot;desc&quot;: &quot;Represents an active, locked session for a specific data key.&quot;,
            &quot;lua_type&quot;: &quot;typeof(setmetatable({} :: SessionProps&lt;T&gt;, {} :: SessionImpl&lt;T&gt;))&quot;,
            &quot;source&quot;: {
                &quot;line&quot;: 153,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;LoadSessionParams&lt;T&gt;&quot;,
            &quot;desc&quot;: &quot;Parameters for the static Session.load method.&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;storeContext&quot;,
                    &quot;lua_type&quot;: &quot;Types.StoreContext&lt;T&gt;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;userIds&quot;,
                    &quot;lua_type&quot;: &quot;{ number }?&quot;,
                    &quot;desc&quot;: &quot;&quot;
                }
            ],
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 165,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;LoadParams&quot;,
            &quot;desc&quot;: &quot;Parameters for the internal load helper function.&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;storeContext&quot;,
                    &quot;lua_type&quot;: &quot;Types.StoreContext&lt;any&gt;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;,
                    &quot;desc&quot;: &quot;&quot;
                }
            ],
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 186,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;LoadResult&quot;,
            &quot;desc&quot;: &quot;Result structure for the internal load helper function.&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;data&quot;,
                    &quot;lua_type&quot;: &quot;any&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;appliedMigrations&quot;,
                    &quot;lua_type&quot;: &quot;{ string }&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;orphanedFiles&quot;,
                    &quot;lua_type&quot;: &quot;{ Types.File }&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;currentFile&quot;,
                    &quot;lua_type&quot;: &quot;Types.File?&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;keyInfo&quot;,
                    &quot;lua_type&quot;: &quot;DataStoreKeyInfo?&quot;,
                    &quot;desc&quot;: &quot;&quot;
                }
            ],
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 203,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        },
        {
            &quot;name&quot;: &quot;CreateSessionParams&quot;,
            &quot;desc&quot;: &quot;Parameters for the internal createSession function.&quot;,
            &quot;fields&quot;: [
                {
                    &quot;name&quot;: &quot;storeContext&quot;,
                    &quot;lua_type&quot;: &quot;Types.StoreContext&lt;any&gt;&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;key&quot;,
                    &quot;lua_type&quot;: &quot;string&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;lockHandle&quot;,
                    &quot;lua_type&quot;: &quot;Locks.LockHandle&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;userIds&quot;,
                    &quot;lua_type&quot;: &quot;{ number }?&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;appliedMigrations&quot;,
                    &quot;lua_type&quot;: &quot;{ string }&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;orphanedFiles&quot;,
                    &quot;lua_type&quot;: &quot;{ Types.File }&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;currentFile&quot;,
                    &quot;lua_type&quot;: &quot;Types.File?&quot;,
                    &quot;desc&quot;: &quot;&quot;
                },
                {
                    &quot;name&quot;: &quot;keyInfo&quot;,
                    &quot;lua_type&quot;: &quot;DataStoreKeyInfo?&quot;,
                    &quot;desc&quot;: &quot;&quot;
                }
            ],
            &quot;private&quot;: true,
            &quot;source&quot;: {
                &quot;line&quot;: 395,
                &quot;path&quot;: &quot;src/Session.luau&quot;
            }
        }
    ],
    &quot;name&quot;: &quot;Session&quot;,
    &quot;desc&quot;: &quot;Manages the in-memory state and persistence lifecycle for a single data key\nwithin a Store. A Session represents an active, locked instance of a key&#x27;s\ndata, coordinating data loading, saving, updates, transactions, migrations,\nand cleanup.\n\nSessions are created internally by [Store:load] after acquiring a distributed\nlock via the Locks module. They handle:\n- Loading initial data by reading the main record, file shards, and pending\n  transactions, applying migrations, or importing legacy data.\n- Providing access to the current data ([Session:get]).\n- Applying mutations ([Session:update]) safely within a `noYield` context and\n  tracking changes.\n- Saving changes back to DataStores ([Session:save], [Session:updateRecord], [Session:writeRecord]),\n  potentially sharding large data via the Files module.\n- Coordinating multi-key transactions ([Store:tx] interacts with Session state).\n- Automatically saving data periodically ([Session:startAutosaving]).\n- Cleaning up orphaned file shards in the background ([Session:orphanFile]).\n- Gracefully unloading data ([Session:unload]), ensuring final saves and lock release.\n\nA Session is intrinsically tied to a [Locks.LockHandle]. If the lock is lost,\nthe Session becomes &#x27;closed&#x27; and unusable, triggering cleanup.&quot;,
    &quot;private&quot;: true,
    &quot;source&quot;: {
        &quot;line&quot;: 27,
        &quot;path&quot;: &quot;src/Session.luau&quot;
    }
}</pre></details></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#types" class="table-of-contents__link toc-highlight">Types</a><ul><li><a href="#Session&lt;T&gt;" class="table-of-contents__link toc-highlight">Session<t></t></a></li></ul></li><li><a href="#functions" class="table-of-contents__link toc-highlight">Functions</a><ul><li><a href="#get" class="table-of-contents__link toc-highlight">:get</a></li><li><a href="#isSaved" class="table-of-contents__link toc-highlight">:isSaved</a></li><li><a href="#save" class="table-of-contents__link toc-highlight">:save</a></li><li><a href="#startAutosaving" class="table-of-contents__link toc-highlight">:startAutosaving</a></li><li><a href="#stopAutosaving" class="table-of-contents__link toc-highlight">:stopAutosaving</a></li><li><a href="#unload" class="table-of-contents__link toc-highlight">:unload</a></li><li><a href="#update" class="table-of-contents__link toc-highlight">:update</a></li><li><a href="#load" class="table-of-contents__link toc-highlight">.load</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Links</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/paradoxum-games/lyra" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Built with Moonwave and Docusaurus</div></div></div></footer></div>
</body>
</html>